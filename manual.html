<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdigidocpp: Libdigidocpp Programmer&#39;s Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doxyfile.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ID.ico"/></td>
  <td id="projectalign">
   <div id="projectname">libdigidocpp<span id="projectnumber">&#160;4.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('manual.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Libdigidocpp Programmer's Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#introduction">Introduction</a><ul><li class="level2"><a href="#about">About DigiDoc</a></li>
<li class="level2"><a href="#format">Format of digitally signed file</a><ul><li class="level3"><a href="#container">ASiC-E (XAdES) container format</a></li>
<li class="level3"><a href="#profiles">Legacy BDOC signature profiles</a><ul><li class="level4"><a href="#BDOC-TM">BDOC signature with time-mark</a></li>
<li class="level4"><a href="#BDOC-TS">BDOC signature with time-stamp</a></li>
</ul>
</li>
<li class="level3"><a href="#asics">ASiC-S container format</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#releasenotes">Release Notes</a></li>
<li class="level1"><a href="#overview">Overview</a><ul><li class="level2"><a href="#References">References and additional resources</a></li>
<li class="level2"><a href="#Terms">Terms and acronyms</a></li>
<li class="level2"><a href="#Supported">Supported functional properties</a></li>
<li class="level2"><a href="#Component">Component model</a></li>
<li class="level2"><a href="#Dependencies">Dependencies</a><ul><li class="level3"><a href="#libraries">Software libraries</a></li>
<li class="level3"><a href="#Schemas">XML Schemas</a><ul><li class="level4"><a href="#schema-modification">XML schema modifications</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#conf">Configuring Libdigidocpp</a><ul><li class="level2"><a href="#loading">Loading configuration settings</a></li>
<li class="level2"><a href="#parameters">Configuration parameters</a><ul><li class="level3"><a href="#logging-settings">Logging settings</a></li>
<li class="level3"><a href="#TS-settings">Time-stamping service settings</a></li>
<li class="level3"><a href="#VerifyService-settings">Signature Verify Service settings</a></li>
<li class="level3"><a href="#pkcs11-settings">PKCS#11 settings</a></li>
<li class="level3"><a href="#CA-settings">Trust anchor/TSL settings</a></li>
<li class="level3"><a href="#proxy-settings">HTTP proxy settings</a></li>
<li class="level3"><a href="#digest-settings">Digest type settings</a></li>
<li class="level3"><a href="#ocspresponder-settings">OCSP responder settings</a></li>
</ul>
</li>
<li class="level2"><a href="#sample-conf">Sample configuration file</a></li>
</ul>
</li>
<li class="level1"><a href="#usage">Using Libdigidocpp API</a><ul><li class="level2"><a href="#initialization">Initialization</a></li>
<li class="level2"><a href="#creating">Creating and signing a DigiDoc document (local signing)</a><ul><li class="level3"><a href="#containercreate">Creating a DigiDoc container</a></li>
<li class="level3"><a href="#adddatafile">Adding data files</a></li>
<li class="level3"><a href="#API-add-sign">Adding signatures</a><ul><li class="level4"><a href="#API-sign-profile">Optionally specify the signature profile</a></li>
<li class="level4"><a href="#API-sign-data">Optionally specify additional signer&#39;s data</a></li>
<li class="level4"><a href="#API-signature-hash">Optionally specify signature digest method</a></li>
<li class="level4"><a href="#API-sign-create">Create the signature</a></li>
<li class="level4"><a href="#validatesig">Validating the created signatures</a></li>
<li class="level4"><a href="#savesig">Save container changes</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#websigning">Creating and signing a DigiDoc document (external signing, e.g. in browser)</a></li>
<li class="level2"><a href="#containeropen">Reading and writing DigiDoc documents</a></li>
<li class="level2"><a href="#validate">Validating signature containers and signatures</a><ul><li class="level3"><a href="#main-method">Using the main validation method</a></li>
<li class="level3"><a href="#additional">Checking for additional errors/warnings</a></li>
<li class="level3"><a href="#validation-status">Determining the validation status</a><ul><li class="level4"><a href="#validatewarnings">Validation status VALID WITH WARNINGS</a></li>
</ul>
</li>
<li class="level3"><a href="#validation-info">Additional information about validation</a><ul><li class="level4"><a href="#validation-overview">Overview of validation activities</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#extracting">Extracting data files</a></li>
<li class="level2"><a href="#removing">Removing signatures and data files</a></li>
<li class="level2"><a href="#shutting-down">Shutting down the library</a></li>
<li class="level2"><a href="#exceptions">Exception handling</a></li>
</ul>
</li>
<li class="level1"><a href="#utility">Libdigidocpp utility program</a><ul><li class="level2"><a href="#Creating">Creating and signing a document (local signing)</a></li>
<li class="level2"><a href="#createBatch">Creating and signing multiple documents</a></li>
<li class="level2"><a href="#add">Add additional files to container</a></li>
<li class="level2"><a href="#websign">Creating and signing a document (external signing, e.g. in browser)</a></li>
<li class="level2"><a href="#Opening">Opening document, validating signatures and extracting data files</a></li>
<li class="level2"><a href="#Adding">Adding signatures</a></li>
<li class="level2"><a href="#Removing">Removing signatures and data files</a></li>
</ul>
</li>
<li class="level1"><a href="#supported-tokens">National and cross-border support</a><ul><li class="level2"><a href="#TSL-overview">TSL list usage in Libdigidocpp</a><ul><li class="level3"><a href="#TSL-init">TSL initialization process</a></li>
</ul>
</li>
<li class="level2"><a href="#tokens">Identity tokens in Libdigidocpp</a></li>
</ul>
</li>
<li class="level1"><a href="#testing">Interoperability testing</a><ul><li class="level2"><a href="#cross-usability">DigiDoc framework cross-usability tests</a></li>
</ul>
</li>
<li class="level1"><a href="#implementation-notes">Libdigidocpp implementation notes</a><ul><li class="level2"><a href="#signature-notes">Digital signature related notes</a></li>
<li class="level2"><a href="#cert-notes">Certificate related notes</a></li>
<li class="level2"><a href="#container-notes">Container related notes</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>Libdigidocpp is the C++ library for creating applications handling digital signatures, their creation and verification. The digitally signed files are created in "DigiDoc format" (with .asice file extension), compliant to XML Advanced Electronic Signatures (<a class="el" href="manual.html#XAdES">XAdES</a>), technical standard published by European Telecommunication Standards Institute (ETSI).</p>
<p>Additionally the libdigidocpp library can be used to read and verify the digitally timestamped containers (using .asics file extension) with a single datafile. There is possible to validate <a class="el" href="manual.html#ASiC">ASiC</a> (<a class="el" href="manual.html#CAdES">CAdES</a>), <a class="el" href="manual.html#PDF">PDF</a> and <a class="el" href="manual.html#DDOC">DDOC</a> formats with <a class="el" href="manual.html#SiVa">SiVa</a> service.</p>
<p>Development of the library can be monitored in GitHub environment: <a href="https://github.com/open-eid/libdigidocpp">https://github.com/open-eid/libdigidocpp</a>.</p>
<h2><a class="anchor" id="about"></a>
About DigiDoc</h2>
<p>Libdigidocpp library forms a part of the wider DigiDoc system framework which offers a full-scale architecture for digital signature and documents, consisting of software libraries (C++ and Java), SiVa service and end-user applications such as DigiDoc4 according to the following figure:</p>
<div class="image">
<object type="image/svg+xml" data="digidoc_framework.svg" style="pointer-events: none;"></object>
<div class="caption">
DigiDoc framework</div></div>
<p>It is easy to integrate DigiDoc components into existing applications in order to allow for creation, handling, forwarding and verification of digital signatures. All applications share common digitally signed file formats.</p>
<h2><a class="anchor" id="format"></a>
Format of digitally signed file</h2>
<p>Actively used digitally signed file formats in DigiDoc system are:</p><ul>
<li>ASiC-E - default format for files in Libdigidocpp library, described in <a class="el" href="manual.html#ASiC">The ETSI standard ETSI EN 319 162-1</a>;</li>
<li>BDOC 2.1 - legacy format, described in <a class="el" href="manual.html#BDOC">BDOC2.1:2013</a>, The library implements only read-only support for the format;</li>
<li>ASiC-S - timestamped container, described in <a class="el" href="manual.html#ASiC">The ETSI standard ETSI EN 319 162-1</a>. The library implements only read-only support for the format.</li>
</ul>
<p>The following chapters provides an overview of ASiC-E (XAdES) digitally signed file format which is the preferred format for creating signed documents in Libdigidocpp library.</p>
<h3><a class="anchor" id="container"></a>
ASiC-E (XAdES) container format</h3>
<p>The ETSI standard <a class="el" href="manual.html#ASiC">EN 319 162-1</a> called Associated Signature Containers (ASiC) defines format of container for encapsulation of signed files and signatures with extra information. The container type used in case of ASiC-E documents is Associated Signature Extended form. In the container <a class="el" href="manual.html#XAdES">XAdES EN 319 132-1</a> (XML Advanced Electronic Signatures) format signatures are used.</p>
<p>ASiC-E container is a ZIP file consisting of the following objects:</p><ul>
<li>a file named "mimetype", containing only the following value: application/vnd.etsi.asic-e+zip</li>
<li>data files in original format.</li>
<li>META-INF subdirectory, consisting of:<ul>
<li>manifest.xml – a file containing list of all files in the container. The list does not contain the "mimetype" file and files in META-INF subdirectory.</li>
<li>signatures*.xml – one file for each signature, ‘*’ in the file’s name denotes the sequence number of a signature (counting starts from zero). The signatures*.xml file also incorporates certificates, validity confirmation and meta-data about the signer.</li>
</ul>
</li>
</ul>
<p>When ASiC-E container is signed then all files in the container are signed, except of the mimetype file and files in META-INF subdirectory.</p>
<p>Original files (which were signed) along with the signature(s), timestamp(s), validation confirmation(s) and certificates are encapsulated within the container. As a result, it is possible to verify signature validity without any additional external information – the verifier should trust the issuer of signer’s certificate, TS Authority and the OCSP responder’s certificate.</p>
<div class="image">
<object type="image/svg+xml" data="asic.svg" style="pointer-events: none;"></object>
<div class="caption">
ASiC-E container's contents</div></div>
<h3><a class="anchor" id="profiles"></a>
Legacy BDOC signature profiles</h3>
<p>The format of the BDOC 2.1 digitally signed file is based on ETSI <a class="el" href="manual.html#XAdES">XAdES TS 101 903</a> standard. The XAdES standard defines formats for advanced electronic signatures that remain valid over long periods of time. The ETSI standard <a class="el" href="manual.html#XAdES">TS 103 171</a> "XAdES Baseline Profile" further profiles the XAdES signature by putting limitations on choices.</p>
<p>BDOC 2.1 specification defines two profiles of qualified BDOC signatures: BDOC with time-mark and BDOC with time-stamp. Both of the profiles offer long-term validation possibility by incorporating the necessary validation data in the signature. Both of the profiles are compliant to XAdES LT-Level requirements.</p>
<h4><a class="anchor" id="BDOC-TM"></a>
BDOC signature with time-mark</h4>
<p>The BDOC signature with time-mark is based XAdES-EPES signature (Explicit Policy based Electronic Signature, see <a class="el" href="manual.html#XAdES">XAdES</a>).</p>
<p>In order to offer long time validation, it is necessary to obtain proof of validity of the signer’s X.509 digital certificate issued by a certificate authority (CA) at the time of signature creation. In case of BDOC with time-marks (TM profile), the proof is obtained with a single OCSP response that has a specific "nonce" field’s value (i.e. the time-mark).</p>
<p>The hash of the created signature (the &lt;SignatureValue&gt; element’s contents) is sent within the OCSP request’s and received back within the response’s "nonce" field. The OCSP request’s and response’s "nonce" field is a DER-encoding of the following ASN.1 data structure: </p><div class="fragment"><div class="line">TBSDocumentDigest ::= SEQUENCE {</div>
<div class="line">    algorithm AlgorithmIdentifier,</div>
<div class="line">    digest OCTET STRING</div>
<div class="line">}</div>
</div><!-- fragment --><p> The element digest is a hash value of the binary value of the &lt;SignatureValue&gt; element’s contents, element algorithm determines the used hash algorithm as defined in <a class="el" href="manual.html#RFC5280">RFC 5280</a> clause 4.1.1.2.</p>
<p><b>The time-mark provides proof of the following:</b></p><ol type="1">
<li>The signature value existed at a certain point of time (issuance time of the OCSP confirmation) – the verifier can calculate the hash of the signature and check its conformance to the OCSP response’s "nonce" field.</li>
<li>The signer’s certificate was valid (provided that the OCSP response is positive and does indeed confirm the certificate’s validity) at a certain point of time</li>
</ol>
<p>It is important to notice that additional time-stamps are not necessary as time of signing and time of obtaining validity information is indicated in the OCSP response (i.e. the time-mark).</p>
<p><b>NB!</b> The issuance time (producedAt field’s value) of the OCSP response (the time-mark) is regarded as the time of signature creation.</p>
<p>To achieve long-time validity of digital signatures, a secure log system is employed within the model. All OCSP responses and changes in certificate validity are securely logged to preserve digital signature validity even after private key compromise of CA or OCSP responder.</p>
<div class="image">
<object type="image/svg+xml" data="security.svg" style="pointer-events: none;"></object>
<div class="caption">
Security model of time-marking mechanism</div></div>
<h4><a class="anchor" id="BDOC-TS"></a>
BDOC signature with time-stamp</h4>
<p>The BDOC signature with time-stamp is based on XAdES-BES signature (Basic Electronic Signature, see <a class="el" href="manual.html#XAdES">XAdES</a>).</p>
<p>In order to offer long time validation, it is necessary to obtaining proof of validity of the signer’s X.509 digital certificate issued by a certificate authority (CA) at the time of signature creation.</p>
<p>In case of BDOC with time-stamp (TS profile), the proof is provided as follows:</p><ol type="1">
<li>RFC3161 compliant time-stamp is obtained from a time-stamping service. The hash of the created signature (&lt;SignatureValue&gt; element block) is sent to the time-stamping server. The server’s response contains a time-stamp token with the same hash value that can later be used to validate that the time-stamp was indeed issued for the respective signature. The time-stamp token received from the server is added to the signature providing a proof from a trusted source that the signature value existed at a certain point of time.</li>
<li>RFC 6960 compliant OCSP confirmation is obtained from an OCSP service. The OCSP response received from the server is used as a trusted source to confirm that the signer’s certificate was valid at a certain point of time (producedAt field’s value in the OCSP response).</li>
<li>The verifier must check the time-stamp token’s and OCSP confirmation’s time difference. If the difference is acceptable then it can stated that the signer’s certificate was valid at the time of signature creation.</li>
</ol>
<p><b>NB!</b> The issuance time (getTime field’s value) of the time-stamp token (received with the response from time-stamping server) is regarded as the time of signature creation.</p>
<h3><a class="anchor" id="asics"></a>
ASiC-S container format</h3>
<p>In addition to the Associated Signature Extended form (ASiC-E) the <a class="el" href="manual.html#ASiC">ETSI standard TS 102 918</a> defines a Simple form which is used for encapsulating a single datafile and signature or time-stamp token associated with it.</p>
<p>ASiC-S container is a ZIP file consisting of the following objects:</p><ul>
<li>an optional file named "mimetype", containing only the following value: application/vnd.etsi.asic-s+zip</li>
<li>data object (file) in original format.</li>
<li>META-INF subdirectory with one of the following files:<ul>
<li>signatures.p7s</li>
<li>signatures.xml</li>
<li>timestamp.tst</li>
</ul>
</li>
</ul>
<p>The libdigidocpp library supports only containers with time-stamp token (container includes META-INF/timestamp.tst). The time-stamp token is a binary representation of TimeStampToken as defined in RFC 3161. The time-stamp is obtained from a time-stamping service; it is calculated over the entire binary content of the data object. Since both the original file and time-stamp are included in the container, it is possible to verify that the timestamped file existed at a certain point of time.</p>
<p>The library can be used only for reading the content of the container and validating that the time-stamp was indeed issued for the data object included in the container.</p>
<h1><a class="anchor" id="releasenotes"></a>
Release Notes</h1>
<div class="fragment"><div class="line">Libdigidocpp library [4.2.0](https://github.com/open-eid/libdigidocpp/releases/tag/v4.2.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries and platform support</div>
<div class="line">  (#620, #651, #654, #655, #662, #659, #667)</div>
<div class="line">- Improve signature and container compatibility</div>
<div class="line">  (#660)</div>
<div class="line">- Other fixes and optimizations</div>
<div class="line">  (#653, #664, #657, #666, #663, #661)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v4.1.0...v4.2.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [4.1.0](https://github.com/open-eid/libdigidocpp/releases/tag/v4.1.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries and platform support</div>
<div class="line">  (#629, #633, #642, #638, #621, #643, #648, #636)</div>
<div class="line">- Improve signature and container compatibility</div>
<div class="line">  (#623, #626, #624, #646, #640, #645, #647, #644)</div>
<div class="line">- Other fixes and optimizations</div>
<div class="line">  (#625, #632, #631, #594, #649)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v4.0.0...v4.1.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [4.0.0](https://github.com/open-eid/libdigidocpp/releases/tag/v4.0.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Major rewrite of library internals due upstream dependecy xalan-c and xml-security-c package has been retired.</div>
<div class="line">  https://shibboleth.atlassian.net/wiki/spaces/DEV/pages/3726671873/Santuario</div>
<div class="line">  https://lists.apache.org/thread/tls9xgp45zbhzc9k8jhd3m49r6npbrql</div>
<div class="line">- Update libraries and platform support</div>
<div class="line">  (#572, #565, #571, #570, #574, #578, #581, #582, #583, #579, #587, #589, #590, #563, #592, #597, #605, #608, #616)</div>
<div class="line">- Improve signature and container compatibility</div>
<div class="line">  (#573, #585, #586, #588, #591, #584, #596, #593, #595, #603, #604, #607, #613, #609, #619)</div>
<div class="line">- Other fixes and optimizations</div>
<div class="line">  (#564, #577, #580, #599, #606, #612, #614, #611, #610)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.17.0...v4.0.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.17.1](https://github.com/open-eid/libdigidocpp/releases/tag/v3.17.1) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Keep previous signature in memory to avoid changing its structure</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.17.0...v3.17.1)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.17.0](https://github.com/open-eid/libdigidocpp/releases/tag/v3.17.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries and platform support (#549, #554, #558, #553)</div>
<div class="line">- Improve signature and container compatibility (#543, #545, #559, #561, #552)</div>
<div class="line">- Other fixes and optimizations (#542, #550, #557, #544, #551, #555)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.16.0...v3.17.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.16.0](https://github.com/open-eid/libdigidocpp/releases/tag/v3.16.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries and platform support (#530, #477, #534, #535)</div>
<div class="line">- Improve signature and container compatibility (#528)</div>
<div class="line">- Other fixes and optimizations (#529, #533, #532, #536)</div>
<div class="line">- Removed time-mark signature creation support (#527, #539)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.15.0...v3.16.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.15.0](https://github.com/open-eid/libdigidocpp/releases/tag/v3.15.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries and platform support (#525, #522, #515, #503, #511, #514, #516, #517, #523, #505)</div>
<div class="line">- Improve code quality and documentation (#526, #521, #524, #520, #501)</div>
<div class="line">- Improve signature and container compatibility (#506, #504, #502, #491)</div>
<div class="line">- Other fixes and optimizations (#435, #481, #508, #433, #519, #497)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.11...v3.15.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.12](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.12) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Fix digidoc-tool file extraction</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.11...v3.14.12)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.11](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.11) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update libraries (#472, #495, #490, #500)</div>
<div class="line">- TSL parsing improvementsa (#492, #495, #499)</div>
<div class="line">- Fix memory leaks (#488)</div>
<div class="line">- Prefer PSS padding with RSA key (#437)</div>
<div class="line">- Code fixes and improvements (#478, #487, #513)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.10...v3.14.11)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.10](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.10) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Trust intermediate certificates in trust store (#476)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.9...v3.14.10)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.9](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.9) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- TSL parsing improvements (#475, #451, #465, #464, #463, #439, #443)</div>
<div class="line">- Allow validate signatures with TimeStampValidationData (#455)</div>
<div class="line">- Build python bindings (#456)</div>
<div class="line">- OpenSSL 3.0 support and minimum supported 1.1.1 (#468, #461, #453)</div>
<div class="line">- Update documentation (#434)</div>
<div class="line">- Fix parameter locking when false is defined (#448)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.8...v3.14.9)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.8](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.8) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update TSL signer certificates (#438)</div>
<div class="line">- Optimize signing process (#404, #417, #430)</div>
<div class="line">- Improve SiVa validation (#419, #426, #429)</div>
<div class="line">- Remove SK OCSP proxy URL (#427)</div>
<div class="line">- Improve signature validation (#383, #420, #432, #444)</div>
<div class="line">- Updates for libraries and examples (#423, #424, #381, #425)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.7...v3.14.8)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.7](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.7) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Remove libdigidoc support (#393)</div>
<div class="line">- Build macOS arm64 (#392)</div>
<div class="line">- Improve compatibility where Xerces-C is configured uint16_t (#391)</div>
<div class="line">- Use same length digest as ECC key (#406)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.5...v3.14.7)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.6](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.6) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update TSL signer certificates</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.5...v3.14.6)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.5](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.5) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Use nlohmann json library (#380)</div>
<div class="line">- Add canonicalization algorithm to time-stamp (#369)</div>
<div class="line">- Add PSS signature support (#366)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.4...v3.14.5)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.4](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.4) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Use unique_ptr on Container::create/open (#355)</div>
<div class="line">- Deprecate std::istream *is method and add std::unique_ptr&lt;std::istream&gt; alternative</div>
<div class="line">- Fix encoding on macOS when LC_ALL is defined (#346)</div>
<div class="line">- Use 64 bit stat on windows (#349)</div>
<div class="line">- Implement SiVa V3 changes (#354)</div>
<div class="line">- Documentation updates and code fixes</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.3...v3.14.4)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.3](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.3) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Change SiVa URL (#335)</div>
<div class="line">- Split user-agent and application name handling (#333)</div>
<div class="line">- Update OpenSSL 1.1.1g and Xerces-C 3.2.3 (#347)</div>
<div class="line">- Workaround OpenSSL 1.1.1f issues (#348)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.2...v3.14.3)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.2](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.2) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Check that OCSP producedAt is later than TimeStamp (#324)</div>
<div class="line">- Update documentation (#326)</div>
<div class="line">- Other code and build cleanups</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.1...v3.14.2)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.1](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.1) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Fix LGTM and Coverity warnings and errors</div>
<div class="line">- Add TSUrl parameter to digidoc-tool (#293)</div>
<div class="line">- Update OpenSSL to 1.1.1</div>
<div class="line">- Add stricter validation rules (#317, #295)</div>
<div class="line">- SiVa V3 compatibility</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.14.0...v3.14.1)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.14.0](https://github.com/open-eid/libdigidocpp/releases/tag/v3.14.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update LOTL URL (#304)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.9...v3.14.0)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.9](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.9) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Update dependencies (#285, #275, #274, #268, #266, #265, #258)</div>
<div class="line">- Optimize TSL loading and SiVa request (#271, #252, #280)</div>
<div class="line">- Update TSL trust certificates (#287)</div>
<div class="line">- Improve C# and java bindings (#282, #278, #272, #270)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.8...v3.13.9)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.8](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.8) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Use ETag instead Last-Modified to verify cached file (#238)</div>
<div class="line">- Fix signature verify with OpenSSL 1.1 (#240)</div>
<div class="line">- Check OCSP TM OID (#247)</div>
<div class="line">- Handle TSA error code 429 and cleanup some code (#250)</div>
<div class="line">- Upload artifacts to AWS (#253)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.7...v3.13.8)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.7](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.7) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Remove compiler warnings</div>
<div class="line">- Change SiVa service URL to https://siva.eesti.ee/V2/validate</div>
<div class="line">- Update Xml-Security-C 2.0.1 (#224), OpenSSL 1.0.2p (#222)</div>
<div class="line">- Fix crashes #223, #228, #221 and memory leaks #224</div>
<div class="line">- Code cleanups and warning fixes</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.6...v3.13.7)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.6](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.6) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Add new OCSP access certificate and use when old is expired (#205)</div>
<div class="line">- Build java bindings on desktop platforms (#204)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.5...v3.13.6)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.5](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.5) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Add TSL cert tl-mp5 and generate headers dynamically (#174)</div>
<div class="line">- Use case sensitive zip file compare (#175)</div>
<div class="line">- Android build improvements (#179, #180)</div>
<div class="line">- SiVa service validation improvements (#185, #184)</div>
<div class="line">- Update Xerces-C to 3.2.1 (#187)</div>
<div class="line">- Optimize TSL loading (#192)</div>
<div class="line">- PDF Experimental backend (#57)</div>
<div class="line">- Build fixes and improvements</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.3...v3.13.5)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.4](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.4) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Add TSL cert tl-mp5 and generate headers dynamically (#174)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.3...v3.13.4)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.3](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.3) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- SiVa V2 support (#166)</div>
<div class="line">- Android build fixes (#167, #164)</div>
<div class="line">- Fix loading unsigned TM signatures (#161)</div>
<div class="line">- Don&#39;t terminate TSL parsing when TakenOvertByType extension is found (#160)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.2...v3.13.3)</div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.2](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.2) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Implement ECDSA token support (#152)</div>
<div class="line">- Fix issuer name with UTF-8 characters (#146)</div>
<div class="line">- Check mimetype format (#150)</div>
<div class="line">- Update xerces-c to 3.2.0 (#149)</div>
<div class="line">- Take OCSP URL from AIA extension (#138)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.1...v3.13.2)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.1](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.1) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Restore compatibility with jdigidoc 3.11</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.13.0...v3.13.1)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.13.0](https://github.com/open-eid/libdigidocpp/releases/tag/v3.13.0) release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">- Relax validation of BDOC to accept sub-elements of SignatureProductionPlace in any order</div>
<div class="line">- Speed up signing large files by handling them as file stream instead of in-memory</div>
<div class="line">- Improved compatability with Latvian/Lithuanian ASiC-E documents</div>
<div class="line">- XAdES EN support</div>
<div class="line">- Better handling of malicious zip files</div>
<div class="line">- Added ASiC-S validation support</div>
<div class="line">- Improve TSL parsing</div>
<div class="line">- Improve compatibilty with EIDAS</div>
<div class="line">- Disable External Entities parsing</div>
<div class="line">- Use SiVa service for parsing PDF and DDoc (on platforms where libdigidoc backend is missing)</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.12.2...v3.13.0)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library [3.12.3](https://github.com/open-eid/libdigidocpp/releases/tag/v3.12.3) release notes</div>
<div class="line">--------------------------------------------</div>
<div class="line">- Verify signing certificate QCSD OID-s</div>
<div class="line"> </div>
<div class="line">[Full Changelog](https://github.com/open-eid/libdigidocpp/compare/v3.12.2...v3.12.3)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.12.2 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.12.1</div>
<div class="line">- Fix issues found by coverity</div>
<div class="line">- digidoc-tool improvements</div>
<div class="line">- API option to verify PDF validator service SSL certificate</div>
<div class="line">- Added new TSL signing certificates</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.12.1 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.12.0</div>
<div class="line">- Added Container::prepareWebSignature for C# bindings</div>
<div class="line">- Documentation updates</div>
<div class="line">- Fix crash parsing References without ID attribute</div>
<div class="line">- Handle TSL v5 service status parameters</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.12.0 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.11.1</div>
<div class="line"> </div>
<div class="line">- Fix download TSL-s over proxy in case of HTTPS connections</div>
<div class="line">- Behaviour change, proxy tunnel SSL option is now default on</div>
<div class="line">- Export PKCS12Signer class</div>
<div class="line">- Update C# bindings</div>
<div class="line">- Find OCSP certificate from TSL list</div>
<div class="line">- On loading TSL lists, verify HTTP result is 200</div>
<div class="line">- Major API changes, SO version increased to 1. Applications need to adopt new changes and recompile applications.</div>
<div class="line">- Added support for signing in web browser</div>
<div class="line">- Example projects for iOS and Android</div>
<div class="line">- Disable SHA1 support on signature creation</div>
<div class="line">- OCSP nonce compatibility with other digest info headers</div>
<div class="line"> </div>
<div class="line">List API changes https://github.com/open-eid/libdigidocpp/wiki/API-changes-(v3.12)</div>
<div class="line">List of known issues: https://github.com/open-eid/libdigidocpp/wiki/Known-issues</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.11.1 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.11.0</div>
<div class="line"> </div>
<div class="line">- Verify HTTP result before processing TSL lists</div>
<div class="line">- Include cdigidoc.exe</div>
<div class="line"> </div>
<div class="line">List of known issues: https://github.com/open-eid/libdigidocpp/wiki/Known-issues</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.11.0 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.10.3</div>
<div class="line"> </div>
<div class="line">- Improved ECDSA signature size calculation</div>
<div class="line">- Optimized HTTP download speed (e.g. when updating TSL lists) by compressing the traffic (using gzip Content-Encoding)</div>
<div class="line">- Added support for validating BDOC 2.1 time-stamp signatures with archive time-stamps </div>
<div class="line">- Added option to specify different digest algorithm for the signature value than the default algorithm used in case of other digest values in the signature. </div>
<div class="line">    - Added API methods Signer::setMethod(), Signer::method(), XmlConfV4::signatureDigestUri()</div>
<div class="line">    - Added configuration parameters signer.digestUri and signer.signatureDigestUri </div>
<div class="line">    - Added parameter -sigsha(1,224,256,384,512) to digidoc-tool utility program</div>
<div class="line">- Improved OCSPserver access certificate usage, relative pkcs12.cert configuration parameter value is now resolved to the library&#39;s installation path, instead of current working directory</div>
<div class="line">- Added option to download TSL-s over proxy in case of HTTPS connections</div>
<div class="line">    - Added API methods XmlConfV4::proxyForceSSL(), XmlConfV4::proxyTunnelSSL() </div>
<div class="line">    - Added configuration file parameters forceSSL and tunnelSSL</div>
<div class="line">- Fixed OCSP certificate verification, the verification is now done based on the OCSP poducedAt field&#39;s time.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.10.3 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.10.0</div>
<div class="line"> </div>
<div class="line">- Updated experimental .NET C# wrapper swig configuration file to recent API</div>
<div class="line">- Included C# wrapper files in Windows installer package</div>
<div class="line">- Filter out CA certificates in PKCS11Signer implementation to support Finland ID-card signing in digidoc-tool</div>
<div class="line">- Improved signature validation, it is now checked that at least one data file is signed</div>
<div class="line">- Disabled OCSP time slot check when requesting OCSP confirmation, the local computer time difference compared to OCSP server time is not checked.</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.10.0 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.9</div>
<div class="line"> </div>
<div class="line">- Changed the default BDOC signature profile to BDOC-TS (ASiC-E LT signature with time-stamp) for new signatures. To create a BDOC-TM (LT_TM, i.e. time-mark) signature, specify the &quot;time-mark&quot; profile value in Container::sign(Signer *signer, const string &amp;profile) method call.</div>
<div class="line">- Fixed time zone usage when validating signer certificate validity period&#39;s starting time. Previously, &quot;Not yet valid&quot; error message was displayed even if the certificate was actually already valid.</div>
<div class="line">- Improved BDOC signatures*.xml file&#39;s XML structure validation. Transforms XML element is now allowed to enhance interoperability.</div>
<div class="line">- Improved TSL functionality</div>
<div class="line">    - In case of BDOC format, checking the trustworthiness of trust services (CA, OCSP, time-stamping services) is now possible only by using TSL lists. Previously used certificate store functionality is no longer supported.</div>
<div class="line">    - Removed country-specific filtering of the national TSLs that are referenced in the European Commission&#39;s central TSL list.</div>
<div class="line">    - Added possibility to use multiple parallel European Commission&#39;s TSL signing certificates to enable transition to a new certificate, if needed.</div>
<div class="line">    - Added checking of the TSL&#39;s officially published SHA-256 digest value online to determine if a newer version of the TSL is available.</div>
<div class="line">    - Added configuration parameter &quot;tsl.onlineDigest&quot; that enables to disable the TSL online SHA-256 digest check.</div>
<div class="line">    - Removed configuration file parameters &quot;tsl.url&quot; and &quot;tsl.cert&quot;. The respective values can be set directly from the library&#39;s API.</div>
<div class="line">    - Added TSL downloading timeout, the value is set to 10 seconds for each TSL. Added configuration parameter &quot;tsl.timeOut&quot; that can be used to configure the timeout value.</div>
<div class="line">    - Improved TSL loading when proxy is used, proxy settings are ignored in case of HTTPS connections.</div>
<div class="line">- Changed the XmlConf class to deprecated, use XmlConfV2 instead.</div>
<div class="line">- Changed the OCSP responder URL for EID-SK 2011 certificates, http://ocsp.sk.ee is now used.</div>
<div class="line">- Fixed error message text that appears when data file&#39;s mime-type in BDOC manifest.xml does not conform with mime-type value in signatures*.xml file. Previously, the displayed mime-type values were interchanged between the signatures*.xml and manifest.xml files.</div>
<div class="line">- The library&#39;s release notes is now also copied to the library&#39;s documentation: http://open-eid.github.io/libdigidocpp/manual.html#releasenotes </div>
<div class="line">- Development of the software can now be monitored in GitHub environment: https://github.com/open-eid/libdigidocpp</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.9 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line">Changes compared to ver 3.8</div>
<div class="line"> </div>
<div class="line">- Added support for creating and validating BDOC signatures with time-stamps (BDOC-TS profile). </div>
<div class="line">    - By default, there is no time-stamping service support configured.</div>
<div class="line">    - Added new parameter &quot;ts.url&quot; to digidocpp.conf configuration file that specifies the time-stamping service used during signature creation. </div>
<div class="line">    - Added support for &quot;time-stamp&quot; profile value for digidoc::Container::sign(Signer *signer, const std::string &amp;profile) method when creating BDOC-TS signature via API.</div>
<div class="line">    - Added time-stamp (TS) profile support for digidoc-tool utility program&#39;s &quot;sign&quot; and &quot;create&quot; commands. TS profile can be set with &quot;--profile=TS&quot; parameter.</div>
<div class="line">    - The signature creation time of BDOC-TS signature is the time-stamp&#39;s creation time (in case of a signature with time-stamp, the OCSP validity confirmation&#39;s creation time is the signing time). </div>
<div class="line">    - Added validation check for difference between OCSP validity confirmation&#39;s production time and time-stamp&#39;s production time. An exception is thrown if the OCSP confirmation&#39;s time is earlier than time-stamp&#39;s time. If the OCSP confirmation&#39;s time is later than time-stamp&#39;s time by more than 15 minutes then a warning is returned. If the difference is more than 24 hours then exception is thrown. </div>
<div class="line">- Added support for using TSL (Trusted Service List) list as trust anchor when checking certificates&#39; trustworthiness during signature creation and validation.</div>
<div class="line">    - By default, European Commission TSL list is used (https://ec.europa.eu/information_society/policy/esignature/trusted-list/tl-mp.xml) as source for finding country-specific TSL lists. Finnish, Estonian, Latvian and Lithuanian country-specific TSL lists are used by default.</div>
<div class="line">    - Added TSL usage configuration possibilities to digidocpp.conf file. Use &quot;tsl.autoupdate&quot;, &quot;tsl.cache&quot;, &quot;tsl.cert&quot; and &quot;tsl.url&quot; configuration parameters to change the default TSL settings.</div>
<div class="line">    - Added command &quot;tsl&quot; to digidoc-tool utility program, the command prints out TSL diagnostics and validates the list.</div>
<div class="line">    - Added possibility to disable all TSL functionality in the library by setting CMake USE_TSL parameter to &quot;false&quot; when building the library.</div>
<div class="line">    - Added class XmlConfV2 that should be used instead of XmlConf class if it is needed to configure time-stamp and TSL related configuration properties. </div>
<div class="line">    - Added Xalan library for processing TSL files.</div>
<div class="line">- Added support for adding OCSP confirmation to signature if the signer&#39;s certificate is issued by &quot;VRK CA for Qualified Certificates - G2&quot; or &quot;VRK Gov. CA for Citizen Qualified Certificates - G2&quot;.</div>
<div class="line">- Improved BDOC document&#39;s validation, it is now checked that the data file mime-type value in manifest.xml file and the respective value in signatures*.xml file in &lt;DataObjectFormat&gt;&lt;MimeType&gt; element are the same.</div>
<div class="line">- Added &quot;--mime=&quot; parameter to digidoc-tool utility program&#39;s &quot;create&quot; command. The parameter can be used along with &quot;--file=&quot; parameter to set the mime-type value of a data file. If not set then the default value &quot;application/octet-stream&quot; is used.</div>
<div class="line">- Improved BDOC document&#39;s validation, added check for weak hash algorithm (SHA-1) usage in case of ECDSA signatures.</div>
<div class="line">- Improved BDOC signatures*.xml file&#39;s XML structure validation. It is now additionally checked that unsupported elements CounterSignature, CompleteCertificateRefs, CompleteRevocationRefs, AttributeCertificateRefs, AttributeRevocationRefs, SigAndRefsTimeStamp, RefsOnlyTimeStamp, AttrAuthoritiesCertValues, AttributeRevocationValues, CommitmentTypeIndicationType, AllDataObjectsTimeStamp, IndividualDataObjectsTimeStampType would not exist in the file.</div>
<div class="line">- Improved processing of special characters in URI attribute values according to RFC3986. Special characters in URI are percent-encoded, except of unreserved characters and delimiters. Both percent-encoded and non-percent-encoded characters are supported during signature&#39;s validation. Note that as a result, the files that contain special characters in URI values and have been created with v3.9 might not be compatible with v3.8 of the library.</div>
<div class="line">- Fixed problem that caused erroneous signatures if the data file&#39;s name contained colon character.</div>
<div class="line">- Fixed digidoc-tool utility program &quot;extract&quot; command&#39;s &quot;--extractAll&quot; parameter functionality. Now, if the parameter is present but there is no extraction directory specified then the files are extracted to the working directory.</div>
<div class="line">- Fixed digidoc-tool utility program&#39;s error that caused the program to exit unexpectedly when trying to create or sign a DDOC file.</div>
<div class="line">- Changed Libdigidoc wrapper to fix error which occurred when parsing DDOC document&#39;s data file name that contains some specific special characters. Previously, the special characters were erroneously displayed in escaped form.</div>
<div class="line">- Fixed problem in Libdigidoc wrapper when calculating data file&#39;s size in the course of parsing a DDOC file. Previously, a wrong data file size was returned occasionally.</div>
<div class="line">- Added XAdESv141.xsd schema support for implementing BDOC archive time-stamp profile in the future.</div>
<div class="line">- Started using libc++ library instead of libstdc++ on OSX platform. The libc++ provides full c++11 support.</div>
<div class="line">- All Libdigidocpp documentation is now available in HTML format (see /documentation/html/index.html in the base directory). Updated the existing HTML-based API documentation, transformed the contents of &quot;Libdigidocpp Programmer&#39;s Guide&quot; PDF/Word document to HTML format. Removed the previously used PDF/Word documents.</div>
<div class="line">- Used coverity.com static analysis tool to find source code defects and vulnerabilities. </div>
<div class="line"> </div>
<div class="line">Known issues: </div>
<div class="line">- Version 3.8 of the library cannot open BDOC documents that are created with version 3.9 or higher and contain special characters in the signed data file&#39;s name due to changes in special character percent-encoding method. </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Libdigidocpp library 3.8 release notes</div>
<div class="line">--------------------------------------</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">3.8 is first public release of libdigidocpp as library. API is changed and not compatible compared to 3.7.1 version when libdigidocpp was not yet public library but internal component used by Digidoc3 client.</div>
<div class="line"> </div>
<div class="line">Known issues:</div>
<div class="line">- If a data file with a colon character in its name is added to a BDOC container then the created signature will be erroneous. Thus, colon characters must not be used in data file names.</div>
</div><!-- fragment --><h1><a class="anchor" id="overview"></a>
Overview</h1>
<h2><a class="anchor" id="References"></a>
References and additional resources</h2>
<table class="doxtable">
<tr>
<td><a class="anchor" id="BDOC"></a> BDOC2.1:2013</td><td><p class="starttd">BDOC – Format for Digital Signatures. Version 2.1:2013</p>
<p class="endtd"><a href="https://www.skidsolutions.eu/repository/bdoc-spec21.pdf">https://www.skidsolutions.eu/repository/bdoc-spec21.pdf</a><br  />
 Other releases:<br  />
 <a href="https://www.skidsolutions.eu/repository/bdoc-spec20.pdf">https://www.skidsolutions.eu/repository/bdoc-spec20.pdf</a><br  />
 <a href="https://www.skidsolutions.eu/repository/bdoc-spec212.pdf">https://www.skidsolutions.eu/repository/bdoc-spec212.pdf</a><br  />
 <a href="https://www.id.ee/wp-content/uploads/2020/08/bdoc-spec21-est.pdf">https://www.id.ee/wp-content/uploads/2020/08/bdoc-spec21-est.pdf</a><br  />
 <a href="https://www.id.ee/wp-content/uploads/2020/01/bdoc-spec212-est.pdf">https://www.id.ee/wp-content/uploads/2020/01/bdoc-spec212-est.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="DDOC"></a>DigiDoc format</td><td><p class="starttd">DigiDoc file format</p>
<p class="endtd"><a href="https://www.id.ee/wp-content/uploads/2020/08/digidoc_format_1.3.pdf">https://www.id.ee/wp-content/uploads/2020/08/digidoc_format_1.3.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="XML-DSIG"></a>XML-DSIG</td><td><p class="starttd">IETF RFC 3275: "XML-Signature Syntax and Processing"</p>
<p class="endtd"><a href="http://www.ietf.org/rfc/rfc3275.txt">http://www.ietf.org/rfc/rfc3275.txt</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="XML-DSIG-1-1"></a>XML-DSIG 1.1</td><td><p class="starttd">XML Signature Syntax and Processing. Version 1.1</p>
<p class="endtd"><a href="http://www.w3.org/TR/xmldsig-core1/">http://www.w3.org/TR/xmldsig-core1/</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="XAdES"></a>XAdES</td><td><p class="starttd">ETSI EN 319 132-1 V1.3.1 (2024-07) - Building blocks and XAdES baseline signatures<br  />
 ETSI TS 101 903 V1.4.2 (2010-12) – XML Advanced Electronic Signatures<br  />
 ETSI TS 103 171 V2.1.1 (2012-03) - XAdES Baseline Profile</p>
<p class="endtd"><a href="https://www.etsi.org/deliver/etsi_en/319100_319199/31913201/01.03.01_60/en_31913201v010301p.pdf">https://www.etsi.org/deliver/etsi_en/319100_319199/31913201/01.03.01_60/en_31913201v010301p.pdf</a><br  />
 <a href="http://www.etsi.org/deliver/etsi_ts/101900_101999/101903/01.04.02_60/ts_101903v010402p.pdf">http://www.etsi.org/deliver/etsi_ts/101900_101999/101903/01.04.02_60/ts_101903v010402p.pdf</a><br  />
 <a href="http://www.etsi.org/deliver/etsi_ts/103100_103199/103171/02.01.01_60/ts_103171v020101p.pdf">http://www.etsi.org/deliver/etsi_ts/103100_103199/103171/02.01.01_60/ts_103171v020101p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="XAdES-Validation"></a>XAdES Validation</td><td><p class="starttd">ETSI TS 102 853 V1.1.2 (2012-10) – Signature validation procedures and policies</p>
<p class="endtd"><a href="http://www.etsi.org/deliver/etsi_ts/102800_102899/102853/01.01.02_60/ts_102853v010102p.pdf">http://www.etsi.org/deliver/etsi_ts/102800_102899/102853/01.01.02_60/ts_102853v010102p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="CAdES"></a>CAdES EN</td><td><p class="starttd">ETSI EN 319 122-1 V1.2.1 (2021-10) - Building blocks and CAdES baseline signatures</p>
<p class="endtd"><a href="https://www.etsi.org/deliver/etsi_en/319100_319199/31912201/01.02.01_60/en_31912201v010201p.pdf">https://www.etsi.org/deliver/etsi_en/319100_319199/31912201/01.02.01_60/en_31912201v010201p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="ZIP"></a>PKWARE ZIP</td><td><p class="starttd">ZIP File Format Specification</p>
<p class="endtd"><a href="http://www.pkware.com/documents/casestudies/APPNOTE.TXT">http://www.pkware.com/documents/casestudies/APPNOTE.TXT</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="OpenDocument"></a>OpenDocument</td><td><p class="starttd">OASIS "Open Document Format for Office Applications. Version 1.2 Part 3: Packages"</p>
<p class="endtd"><a href="http://docs.oasis-open.org/office/v1.2/cs01/OpenDocument-v1.2-cs01-part3.html#__RefHeading__752803_826425813">http://docs.oasis-open.org/office/v1.2/cs01/OpenDocument-v1.2-cs01-part3.html#__RefHeading__752803_826425813</a><br  />
 Other versions:<br  />
 <a href="http://docs.oasis-open.org/office/v1.0/OpenDocument-v1.0-os.pdf">http://docs.oasis-open.org/office/v1.0/OpenDocument-v1.0-os.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="ASiC"></a>ASiC</td><td><p class="starttd">ETSI EN 319 162-1 V1.1.1 (2016-04) - Associated Signature Containers<br  />
 ETSI TS 102 918 V1.3.1 (2013-06) - Associated Signature Containers<br  />
 ETSI TS 103 174 V2.1.1 (2012-03) - ASiC Baseline Profile</p>
<p class="endtd"><a href="http://www.etsi.org/deliver/etsi_en/319100_319199/31916201/01.01.01_60/en_31916201v010101p.pdf">http://www.etsi.org/deliver/etsi_en/319100_319199/31916201/01.01.01_60/en_31916201v010101p.pdf</a><br  />
 <a href="http://www.etsi.org/deliver/etsi_ts/102900_102999/102918/01.03.01_60/ts_102918v010301p.pdf">http://www.etsi.org/deliver/etsi_ts/102900_102999/102918/01.03.01_60/ts_102918v010301p.pdf</a><br  />
 <a href="http://www.etsi.org/deliver/etsi_ts/103100_103199/103174/02.02.01_60/ts_103174v020201p.pdf">http://www.etsi.org/deliver/etsi_ts/103100_103199/103174/02.02.01_60/ts_103174v020201p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="PDF"></a>PDF (<a class="anchor" id="PAdES"></a>PAdES)</td><td><p class="starttd">ETSI EN 319 142-1 V1.1.1 (2016-04) - PAdES digital signatures</p>
<p class="endtd"><a href="https://www.etsi.org/deliver/etsi_en/319100_319199/31914201/01.01.01_60/en_31914201v010101p.pdf">https://www.etsi.org/deliver/etsi_en/319100_319199/31914201/01.01.01_60/en_31914201v010101p.pdf</a><br  />
 </p>
</td></tr>
<tr>
<td><a class="anchor" id="RFC6960"></a>RFC6960</td><td><p class="starttd">X.509 Internet Public Key Infrastructure Online Certificate Status Protocol – OCSP</p>
<p class="endtd"><a href="http://tools.ietf.org/html/rfc6960">http://tools.ietf.org/html/rfc6960</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="RFC3161"></a>RFC3161</td><td><p class="starttd">Internet X.509 Public Key Infrastructure Time-Stamp protocol</p>
<p class="endtd"><a href="http://tools.ietf.org/html/rfc3161">http://tools.ietf.org/html/rfc3161</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="RFC5280"></a>RFC5280</td><td><p class="starttd">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</p>
<p class="endtd"><a href="http://tools.ietf.org/html/rfc5280">http://tools.ietf.org/html/rfc5280</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="TSL"></a>Trusted Lists</td><td><p class="starttd">ETSI TS 119 612 V2.2.1 (2016-04)</p>
<p class="endtd"><a href="https://www.etsi.org/deliver/etsi_ts/119600_119699/119612/02.02.01_60/ts_119612v020201p.pdf">https://www.etsi.org/deliver/etsi_ts/119600_119699/119612/02.02.01_60/ts_119612v020201p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="SiVa"></a>SiVa</td><td><p class="starttd">Digital signature validation web service that provides SOAP and JSON API to validate files</p>
<p class="endtd"><a href="http://open-eid.github.io/SiVa/">http://open-eid.github.io/SiVa/</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="rel-notes"></a>Release notes</td><td>Libdigidocpp library’s release notes </td></tr>
<tr>
<td><a class="anchor" id="nat-cert"></a>ETSI TS 102 280 (V1.1.1)</td><td><p class="starttd">X.509 V3 Certificate Profile for Certificates Issued to Natural Persons</p>
<p class="endtd"><a href="http://www.etsi.org/deliver/etsi_ts/102200_102299/102280/01.01.01_60/ts_102280v010101p.pdf">http://www.etsi.org/deliver/etsi_ts/102200_102299/102280/01.01.01_60/ts_102280v010101p.pdf</a> </p>
</td></tr>
<tr>
<td><a class="anchor" id="DD-libs"></a>DigiDoc libraries</td><td><a href="https://www.id.ee/en/rubriik/digidoc-libraries/">https://www.id.ee/en/rubriik/digidoc-libraries/</a> </td></tr>
<tr>
<td><a class="anchor" id="openeid-github"></a>ID-software GitHub project</td><td><a href="https://github.com/open-eid">https://github.com/open-eid</a> </td></tr>
<tr>
<td><a class="anchor" id="cpp-github"></a>Libdigidocpp GitHub project</td><td><a href="https://github.com/open-eid/libdigidocpp">https://github.com/open-eid/libdigidocpp</a> </td></tr>
</table>
<h2><a class="anchor" id="Terms"></a>
Terms and acronyms</h2>
<table class="doxtable">
<tr>
<td>ASiC</td><td>Associated Signature Containers </td></tr>
<tr>
<td>ASiC-E</td><td>Extended Associated Signature Containers. A type of ASiC container. </td></tr>
<tr>
<td>ASiC-S</td><td>Associated Signature Container Simple form. A type of ASiC container. </td></tr>
<tr>
<td>BDOC 2.1 (.bdoc)</td><td>Term is used to denote a digitally signed file format which is a profile of XAdES and follows container packaging rules based on OpenDocument and ASiC standards. The document format has been defined in <a class="el" href="manual.html#BDOC">BDOC2.1:2013</a>, an overview is provided in chapter <a class="el" href="manual.html#format">Format of digitally signed file</a> of the current document. </td></tr>
<tr>
<td>CRL</td><td>Certificate Revocation List, a list of certificates (or more specifically, a list of serial numbers for certificates) that have been revoked, and therefore should not be relied upon. </td></tr>
<tr>
<td>DIGIDOC-XML (.ddoc)</td><td>The term is used to denote a DigiDoc document format that is based on the XAdES standard and is a profile of that standard. The current version is 1.3 which has been described in <a class="el" href="manual.html#DDOC">DigiDoc format</a>. </td></tr>
<tr>
<td>ECDSA</td><td>Elliptic Curve Digital Signature Algorithm. Digital Signature Algorithm (DSA) which uses elliptic curve cryptography. Used as an alternative to RSA algorithm. </td></tr>
<tr>
<td>OCSP</td><td>Online Certificate Status Protocol, an Internet protocol used for obtaining the revocation status of an X.509 digital certificate </td></tr>
<tr>
<td>OCSP Responder</td><td>OCSP Server, maintains a store of CA-published CRLs and an up-to-date list of valid and invalid certificates. After the OCSP responder receives a validation request (typically an HTTP or HTTPS transmission), the OCSP responder either validates the status of the certificate using its own authentication database or calls upon the OCSP responder that originally issued the certificate to validate the request. After formulating a response, the OCSP responder returns the signed response, and the original certificate is either approved or rejected, based on whether or not the OCSP responder validates the certificate. </td></tr>
<tr>
<td>PAdES (.pdf)</td><td>Term is used to denote a digitally signed PDF file format which is based on <a class="el" href="manual.html#PAdES">PAdES</a> standards. </td></tr>
<tr>
<td>SK</td><td>SK ID Solutions AS. Certificate Authority in Estonia </td></tr>
<tr>
<td>time-mark</td><td>Mechanism used for adding certificate validity and signing time information with the signature. The information is provided with a special OCSP confirmation (also referred to as time-mark) - hash value of the binary value of the signature (along with hash algorithm identifier in case of BDOC 2.1 document format) must be present in the "nonce" field of the OCSP confirmation. In this case, signature creation time is the issuance time of the OCSP confirmation (producedAt value in the confirmation), additional time-stamp service is not required. The respective signature profile is TM profile (supported in case of DIGIDOC-XML 1.3 and BDOC 2.1 document formats). </td></tr>
<tr>
<td>time-stamp</td><td>Mechanism used for adding certificate validity and signing time information with the signature. The certificate validity information is added to the signature with an OCSP confirmation; the signing time information is added with a time-stamp token retrieved form a time-stamping service. In this case, signature creation time is the issuance time (genTime value in the time-stamp) of the time-stamp token. The respective signature profile is TS profile. </td></tr>
<tr>
<td>archive time-stamp</td><td>Mechanism used for providing long term validity of a XAdES signature. The signature and validation data values are time-stamped. The respective signature profile is TSA profile. </td></tr>
<tr>
<td>TSA</td><td>Time-Stamping Authority. Time-stamping service provider. </td></tr>
<tr>
<td>TSL</td><td>Trust Service status List. Signed list that provides information about the status and the status history of the trust services (including certification, OCSP confirmation and time-stamping services). Used as a trust anchor in case of signature creation and validation to check the trustworthiness of the certificates that are included in the signature. See also <a class="el" href="manual.html#TSL">Trusted Lists</a> </td></tr>
<tr>
<td>X.509</td><td>an ITU-T standard for a public key infrastructure (PKI) and Privilege Management Infrastructure (PMI) which specifies standard formats for public key certificates, certificate revocation lists, attribute certificates, and a certification path validation algorithm </td></tr>
<tr>
<td>XAdES</td><td>XML Advanced Electronic Signatures, a set of extensions to XML-DSIG recommendation making it suitable for advanced electronic signature. Specifies precise profiles of XML-DSIG for use with advanced electronic signature in the meaning of European Union Directive 1999/93/EC. </td></tr>
<tr>
<td>XML-DSIG</td><td>a general framework for digitally signing documents, defines an XML syntax for digital signatures and is defined in the W3C recommendation XML Signature Syntax and Processing </td></tr>
</table>
<h2><a class="anchor" id="Supported"></a>
Supported functional properties</h2>
<p>Libdigidocpp is a library of C++ classes offering the functionality of handling digitally signed files in supported DigiDoc formats. The following functions are implemented:</p><ul>
<li>creating containers in supported DigiDoc formats and adding data files;</li>
<li>creating digital signatures using smart cards or other supported cryptographic tokens;</li>
<li>adding time marks and validity confirmations to digital signatures using OCSP and time-stamping protocols;</li>
<li>validating the digital signatures;</li>
<li>using trust service status lists (TSL) as trust anchors for certificate validation;</li>
<li>extracting data files from a container;</li>
<li>removing signatures and data files from a container.</li>
</ul>
<p>The following table gives overview of functional features that are supported with Libdigidocpp. </p><table class="doxtable">
<tr>
<th>Feature </th><th>Supported values  </th></tr>
<tr>
<td>DigiDoc document format </td><td><ul>
<li>ASiC-E - the main document format to be used.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>BDOC 1.0 file format is not supported (more info can be found from <a href="https://www.id.ee/en/article/digidoc-container-format-life-cycle-2/">https://www.id.ee/en/article/digidoc-container-format-life-cycle-2/</a>).   </dd></dl>
</td></tr>
<tr>
<td>Signature profile </td><td>Signature profiles are based on the profiles defined by XAdES (<a class="el" href="manual.html#XAdES">XAdES</a>).<ul>
<li>time-stamp (TS) - signature profile in case of which the certificate validity information is added to the signature with an OCSP confirmation; the signing time information is added with a time-stamp token (see also <a class="el" href="manual.html#RFC6960">RFC6960</a>) retrieved from a time-stamping service. In this case, signature creation time is regarded as the issuance time of the time-stamp token (genTime value in the time-stamp).</li>
<li>time-mark (TM) - certificate validity and signing time information is added to the signature with a time-mark - a special OCSP confirmation in case of which the hash value of the binary value of the signature (along with hash algorithm identifier in case of BDOC 2.1 document format) must be present in the "nonce" field of the OCSP confirmation. In this case, signature creation time is regarded as the issuance time of the OCSP confirmation (producedAt value in the confirmation), additional time-stamp token is not required.</li>
<li>archive time-stamp (LTA) - the signature and all the accompanying validation data is time-stamped in order to provide long term validity. The profile is supported only in case of BDOC 2.1 document format, the "ArchiveTimeStamp" element is added to the time-stamp or time-mark signature (see also <a class="el" href="manual.html#BDOC">BDOC2.1:2013</a>).   </li>
</ul>
</td></tr>
<tr>
<td>Trust anchors </td><td>Information of trusted CA certificates (trust anchors) is used to validate the trustworthiness of certificates used in the signature. The signer certificate's CA, OCSP responder certificate and time-stamping service's certificate (in case of TS signature profile) must be trusted. Trusted certificates' information is obtained from TSL list (Trust Service status list), the trusted certificates' list is retrieved from a signed TSL list that provides information about the status and the status history of the trust services (including certification, OCSP confirmation and time-stamping services). The European Commission's TSL list is used, more information of which can be found from <a href="https://ec.europa.eu/information_society/policy/esignature/trusted-list/">https://ec.europa.eu/information_society/policy/esignature/trusted-list/</a>. For the TSL specification document, see also <a class="el" href="manual.html#TSL">Trusted Lists</a>. For more information about the TSL implementation and configuration possibilities in Libdigidocpp library, see <a class="el" href="manual.html#TSL-overview">TSL list usage in Libdigidocpp</a> and <a class="el" href="manual.html#CA-settings">Trust anchor/TSL settings</a>.   </td></tr>
<tr>
<td>Signature creation module </td><td><ul>
<li>PKCS#11 – in Linux and macOS environments, the default module for singing with smart card (e.g. Estonian ID card or any other smartcard provided that you have the external native PKCS#11 driver for it).</li>
<li>Windows CryptoAPI – the default module for signing with smart card in Windows environment. By default, a dialog window is opened for the user to choose the signing certificate and enter PIN code.  </li>
</ul>
</td></tr>
<tr>
<td>Cryptographic token type </td><td><ul>
<li>Smart card, e.g. Estonian ID card. Supported signature creation modules are PKCS#11 and Windows CryptoAPI. <dl class="section note"><dt>Note</dt><dd>Usage of USB cryptostick (Aladdin eToken with Digital Stamp certificate (<a href="https://www.skidsolutions.eu/en/services/Digital-stamp">https://www.skidsolutions.eu/en/services/Digital-stamp</a>)) has been tested indirectly with Libdigidocpp - testing has been carried out via DigiDoc desktop application which uses Libdigidocpp as a base layer.   </dd></dl>
</li>
</ul>
</td></tr>
<tr>
<td>Public-key algorithm </td><td><ul>
<li>RSA</li>
<li>ECDSA   </li>
</ul>
</td></tr>
</table>
<h2><a class="anchor" id="Component"></a>
Component model</h2>
<p>The figure below describes the architecture of software and hardware components that are used when creating signatures with Libdigidocpp library. </p><div class="image">
<object type="image/svg+xml" data="components.svg" style="pointer-events: none;"></object>
<div class="caption">
Components used in Libdigidocpp implementation when signing with smart card</div></div>
 <table class="doxtable">
<tr>
<th>Component</th><th>Description </th></tr>
<tr>
<td>PKCS#11</td><td>Widely adopted platform-independent API to cryptographic tokens (HSMs, smart cards and USB tokens), a standard management module of the cryptographic token and its certificates </td></tr>
<tr>
<td>CryptoAPI</td><td>Microsoft Cryptography API. Programming API for implementing cryptographic functions in Windows environment. </td></tr>
<tr>
<td>PC/SC</td><td>Standard communication interface between the computer and the smart card, a cross-platform API for accessing smart card readers </td></tr>
<tr>
<td>IFDHandler</td><td>Interface Device Handler for CCID readers </td></tr>
<tr>
<td>CCID</td><td>USB driver for Chip/Smart Card Interface Devices  </td></tr>
<tr>
<td>Reader</td><td>Device used for communication with a smart card </td></tr>
</table>
<h2><a class="anchor" id="Dependencies"></a>
Dependencies</h2>
<h3><a class="anchor" id="libraries"></a>
Software libraries</h3>
<p>Libdigidocpp library depends on the software libraries listed below. </p><table class="doxtable">
<tr>
<th>Base Component</th><th>Required/optional</th><th>Description </th></tr>
<tr>
<td>OpenSSL</td><td>required</td><td>Used for validating certificates and digest values. </td></tr>
<tr>
<td>libxml2</td><td>required</td><td>Used for validating the documents according to XML Schema, reading and writing XML. </td></tr>
<tr>
<td>xmlsec</td><td>required</td><td>Used for handling signature related components. </td></tr>
<tr>
<td>ZLIB</td><td>required</td><td>Used when compressing and extracting ASiC files in ZIP format. </td></tr>
<tr>
<td>Minizip</td><td>required</td><td>Used when creating and opening ZIP container for ASiC file. If the component is not found from system then bundled version with source code is used. Forms a part of ZLIB component. </td></tr>
<tr>
<td>PKCS11</td><td>optional</td><td>Used for searching for default PKCS#11 driver in the system so that its path could be registered in configuration entries. </td></tr>
<tr>
<td>Doxygen</td><td>optional</td><td>Used for generating API documentation from source code. </td></tr>
<tr>
<td>SWIG</td><td>optional</td><td>Used for creating C# and Java bindings. </td></tr>
</table>
<h3><a class="anchor" id="Schemas"></a>
XML Schemas</h3>
<p>Several XML schemas are used when creating digitally signed documents in ASiC file format and validating their structure. The schemas are included in etc/schema/ subdirectory of the Libdigidocpp distribution package, their description is given in the table below.</p>
<dl class="section note"><dt>Note</dt><dd>Some modifications have been made to some of the schemas. Differences in comparison with the original schemas are listed in section <a class="el" href="manual.html#schema-modification">XML schema modifications</a> of the current document.</dd></dl>
<table class="doxtable">
<tr>
<th>Schema file</th><th>Description </th></tr>
<tr>
<td>OpenDocument_manifest.xsd</td><td>OASIS OpenDocument v1.2 (<a class="el" href="manual.html#OpenDocument">OpenDocument</a>) Defines the structure of META-INF/manifest.xml file in ASiC container. <a href="https://docs.oasis-open.org/office/v1.2/csd06/OpenDocument-v1.2-csd06-manifest-schema.rng">https://docs.oasis-open.org/office/v1.2/csd06/OpenDocument-v1.2-csd06-manifest-schema.rng</a> </td></tr>
<tr>
<td>OpenDocument_dsig.xsd</td><td>OASIS OpenDocument v1.2 (<a class="el" href="manual.html#OpenDocument">OpenDocument</a>) Defines the structure of META-INF/signature.xml file in ADOC container. <a href="https://docs.oasis-open.org/office/v1.2/csd06/OpenDocument-v1.2-csd06-dsig-schema.rng">https://docs.oasis-open.org/office/v1.2/csd06/OpenDocument-v1.2-csd06-dsig-schema.rng</a> </td></tr>
<tr>
<td>en_31916201v010101.xsd</td><td>Associated Signature Containers (<a class="el" href="manual.html#ASiC">ASiC</a>) Defines the format of container for encapsulating the signed documents, signatures and additional information. <a href="http://www.etsi.org/deliver/etsi_ts/102900_102999/102918/01.02.01_60/">http://www.etsi.org/deliver/etsi_ts/102900_102999/102918/01.02.01_60/</a> </td></tr>
<tr>
<td>xmldsig-core-schema.xsd</td><td>XML Signature Core Schema Instance (<a class="el" href="manual.html#XML-DSIG">XML-DSIG</a>) Defines XML syntax for digital signatures. <a href="http://www.w3.org/TR/2008/REC-xmldsig-core-20080610/xmldsig-core-schema.xsd">http://www.w3.org/TR/2008/REC-xmldsig-core-20080610/xmldsig-core-schema.xsd</a> </td></tr>
<tr>
<td>XAdES01903v132-201601.xsd</td><td>XML Advanced Electronic Signatures (<a class="el" href="manual.html#XAdES">XAdES EN</a>) Defines a set of extensions to XML-DSIG making it suitable for advanced electronic signature. <a href="http://uri.etsi.org/01903/v1.3.2/XAdES01903v132-201601.xsd">http://uri.etsi.org/01903/v1.3.2/XAdES01903v132-201601.xsd</a> </td></tr>
<tr>
<td>XAdES01903v141-201601.xsd</td><td>Defines XML syntax for additional elements of XAdES signatures that were added with version 1.4.1 of the (<a class="el" href="manual.html#XAdES">XAdES EN</a>) standard. Needed for implementing archive time-stamp support in the future. <a href="http://uri.etsi.org/01903/v1.4.1/XAdES01903v141-201601.xsd">http://uri.etsi.org/01903/v1.4.1/XAdES01903v141-201601.xsd</a> </td></tr>
<tr>
<td>ts_119612v020201_201601xsd.xsd<br  />
ts_119612v020101_additionaltypes_xsd.xsd<br  />
ts_119612v020101_sie_xsd.xsd</td><td>Defines the format of Trust Service status Lists (<a class="el" href="manual.html#TSL">TSL</a>) that contain information about trusted CA, OCSP and TSA certificates. </td></tr>
<tr>
<td>conf.xsd</td><td>Configuration properties’ schema. Defines the Libdigidocpp configuration file’s digidocpp.conf structure (see also <a class="el" href="manual.html#conf">Configuring Libdigidocpp</a>).  </td></tr>
</table>
<p>The following figure describes dependencies between the abovementioned schemas (direction of the arrow indicates the direction of dependency). </p><div class="image">
<object type="image/svg+xml" data="schemas.svg" style="pointer-events: none;"></object>
<div class="caption">
Dependencies between XML Schemas</div></div>
<h4><a class="anchor" id="schema-modification"></a>
XML schema modifications</h4>
<p>The following section describes modifications that have been made to XML schemas used in Libdigidocpp. The library uses several XML schemas when creating digitally signed documents and validating their structure. The schemas are included in etc/schema/ subdirectory of the Libdigidocpp distribution package, their description has been provided in section <a class="el" href="manual.html#Schemas">XML Schemas</a>.</p>
<p>Modifications are marked between xml comment tags.</p>
<p><b>Schema en_31916201v010101.xsd</b></p>
<p>1) The schema’s location has been altered so that the imported schema file is looked up from the local file system. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;xmldsig-core-schema.xsd&quot;</span>/&gt;</div>
<div class="line"><span class="comment">&lt;!-- originally &quot;http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/xmldsig-core-schema.xsd&quot; --&gt;</span></div>
</div><!-- fragment --><p> 2) Additional schema’s location imports has been added so that the imported schema file is looked up from the local file system. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://uri.etsi.org/01903/v1.3.2#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;XAdES01903v132-201601.xsd&quot;</span>/&gt;</div>
<div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://uri.etsi.org/01903/v1.4.1#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;XAdES01903v141-201601.xsd&quot;</span>/&gt; </div>
</div><!-- fragment --><p><b>Schema xmldsig-core-schema.xsd</b></p>
<p>1) The XMLSchema.dtd reference has been commented out due to implementation issues (otherwise a warning message would be produced). </p><div class="fragment"><div class="line"><span class="comment">&lt;!--</span></div>
<div class="line"><span class="comment">&lt;!DOCTYPE schema</span></div>
<div class="line"><span class="comment">  PUBLIC &quot;-//W3C//DTD XMLSchema 200102//EN&quot; &quot;http://www.w3.org/2001/XMLSchema.dtd&quot;</span></div>
<div class="line"><span class="comment"> [</span></div>
<div class="line"><span class="comment">   &lt;!ATTLIST schema</span></div>
<div class="line"><span class="comment">     xmlns:ds CDATA #FIXED &quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;</span></div>
<div class="line"><span class="comment">   &lt;!ENTITY dsig &#39;http://www.w3.org/2000/09/xmldsig#&#39;&gt;</span></div>
<div class="line"><span class="comment">   &lt;!ENTITY % p &#39;&#39;&gt;</span></div>
<div class="line"><span class="comment">   &lt;!ENTITY % s &#39;&#39;&gt;</span></div>
<div class="line"><span class="comment">  ]&gt;</span></div>
<div class="line"><span class="comment">--&gt;</span></div>
</div><!-- fragment --><p> 2) The initial integer data type used in the original schema is converted into long data type when generating C++ source code from the current schema. However, as the SK issued certificates’ serial numbers are too long to fit into long type variable then the data type has been changed to string. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;X509IssuerSerialType&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">sequence</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;X509IssuerName&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;X509SerialNumber&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;string&quot;</span>/&gt; <span class="comment">&lt;!-- originally type=&quot;integer&quot; --&gt;</span></div>
<div class="line">  &lt;/<span class="keywordtype">sequence</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">complexType</span>&gt;</div>
</div><!-- fragment --><p><b>Schema XAdES01903v132-201601.xsd</b></p>
<p>1) The schema’s location has been modified so that the file is looked up from the local file system. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;xmldsig-core-schema.xsd&quot;</span>/&gt;</div>
<div class="line"><span class="comment">&lt;!-- originally &quot;http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/xmldsig-core-schema.xsd&quot; --&gt;</span></div>
</div><!-- fragment --><p> 2) The "type" attribute has been added, otherwise a warning message would be produced. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SignaturePolicyIdentifierType&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xsd:choice</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SignaturePolicyId&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;SignaturePolicyIdType&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SignaturePolicyImplied&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;AnyType&quot;</span>/&gt; <span class="comment">&lt;!-- added type=&quot;AnyType&quot; --&gt;</span></div>
<div class="line">  &lt;/<span class="keywordtype">xsd:choice</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div>
</div><!-- fragment --><p> 3) The "type" attribute has been added, otherwise a warning message would be produced. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CommitmentTypeIndicationType&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xsd:sequence</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CommitmentTypeId&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ObjectIdentifierType&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:choice</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ObjectReference&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:anyURI&quot;</span></div>
<div class="line">        <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;unbounded&quot;</span>/&gt;</div>
<div class="line">      &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;AllSignedDataObjects&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;AnyType&quot;</span>/&gt; <span class="comment">&lt;!-- added type=&quot;AnyType&quot; --&gt;</span></div>
<div class="line">    &lt;/<span class="keywordtype">xsd:choice</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CommitmentTypeQualifiers&quot;</span></div>
<div class="line">      <span class="keyword">type</span>=<span class="stringliteral">&quot;CommitmentTypeQualifiersListType&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">xsd:sequence</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div>
</div><!-- fragment --><p> 4) Change child elements of type SignedSignaturePropertiesType from "xsd:sequence" to "xsd:all" in order to allow the child elements to be listed in any order. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SignedSignaturePropertiesType&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xsd:all</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SigningTime&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SigningCertificate&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SigningCertificateV2&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SignaturePolicyIdentifier&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SignatureProductionPlace&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SignatureProductionPlaceV2&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SignerRole&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">ref</span>=<span class="stringliteral">&quot;SignerRoleV2&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:any</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;##other&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">maxOccurs</span>=<span class="stringliteral">&quot;unbounded&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">xsd:all</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xsd:attribute</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Id&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:ID&quot;</span> <span class="keyword">use</span>=<span class="stringliteral">&quot;optional&quot;</span>/&gt;</div>
<div class="line">&lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div>
</div><!-- fragment --><p> 5) Change child elements of type SignatureProductionPlaceType from "xsd:sequence" to "xsd:all" in order to allow the child elements to be listed in any order. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:complexType</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SignatureProductionPlaceType&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">xsd:all</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;City&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;StateOrProvince&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;PostalCode&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">xsd:element</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CountryName&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;xsd:string&quot;</span> <span class="keyword">minOccurs</span>=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">xsd:all</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">xsd:complexType</span>&gt;</div>
</div><!-- fragment --><p><b>Schema XAdES01903v141-201601.xsd</b></p>
<p>1) The schema's location has been modified so that the file is looked up from the local file system. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://uri.etsi.org/01903/v1.3.2#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;XAdES01903v132-201601.xsd&quot;</span>/&gt;</div>
<div class="line"><span class="comment">&lt;!-- originally &quot;http://uri.etsi.org/01903/v1.3.2/XAdES01903v132-201601.xsd&quot; --&gt;</span></div>
</div><!-- fragment --><p><b>Schema ts_119612v020201_201601xsd.xsd</b></p>
<p>1) The schemas' locations have been modified so that the file is looked up from the local file system. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://www.w3.org/XML/1998/namespace&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;xml.xsd&quot;</span>/&gt;</div>
<div class="line"><span class="comment">&lt;!-- originally &quot;http://www.w3.org/2001/xml.xsd&quot; --&gt;</span></div>
<div class="line">&lt;<span class="keywordtype">xsd:import</span> <span class="keyword">namespace</span>=<span class="stringliteral">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span> <span class="keyword">schemaLocation</span>=<span class="stringliteral">&quot;xmldsig-core-schema.xsd&quot;</span>/&gt;</div>
<div class="line"><span class="comment">&lt;!-- originally &quot;http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/xmldsig-core-schema.xsd&quot; --&gt;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="conf"></a>
Configuring Libdigidocpp</h1>
<h2><a class="anchor" id="loading"></a>
Loading configuration settings</h2>
<p>Libdigidocpp uses XML configuration file named digidocpp.conf. Configuration file's structure is defined with XML schema "conf.xsd" - the file is included in etc/schema/ subdirectory of Libdigidocpp package. For a sample configuration file, see <a class="el" href="manual.html#sample-conf">Sample configuration file</a>.</p>
<p>It is possible to use two types of configuration files: global and user's file. Global file can be used to determine system-wide settings that cannot be altered by a user's file – it can be done separately for each parameter in the file by setting the parameter's "lock" attribute value to "true". User's file can be used to determine user-specific parameter values.</p>
<p>It is possible to use only one configuration file (either global or user's file) or two files in parallel. In the latter case, the matching user file's parameter entries overwrite global file's entries, if the respective parameter is not defined as locked in the global file.</p>
<p>By default, the configuration file's settings are loaded during the library's initialization – Libdigidocpp looks for global and user configuration files from their default locations depending on the environment:</p><ul>
<li>in case of Windows environment:<ul>
<li>the global configuration file is looked up from the directory where digidocpp.dll library file is located. If the directory doesn't contain /schema subdirectory then the configuration file is looked up from the current working directory.</li>
<li>user configuration file is looked up from the system directory containing application data for the current user: %APPDATA%\digidocpp\digidocpp.conf</li>
</ul>
</li>
<li>in case of macOS:<ul>
<li>the global configuration file is looked up from a location in the file system: digidocpp.framework/Resources/digidocpp.conf</li>
<li>user configuration file is looked up from $HOME/.digidocpp/digidocpp.conf</li>
</ul>
</li>
<li>in case of Linux environment:<ul>
<li>the global configuration file is looked up from a location in the file system: /etc/digidocpp/digidocpp.conf</li>
<li>user configuration file is looked up from $HOME/.digidocpp/digidocpp.conf</li>
</ul>
</li>
</ul>
<p>It is also possible to load global configuration file from a non-default location. In this case, call out the configuration file's initialization method before initializing the library: </p><div class="fragment"><div class="line"><span class="comment">// Initialize global configuration settings from a non-default location</span></div>
<div class="line"><a class="code hl_function" href="classdigidoc_1_1Conf.html#abbfddce7554787e43e53c93865e17aa7">digidoc::Conf::init</a>(<span class="keyword">new</span> <a class="code hl_class" href="classdigidoc_1_1XmlConf.html">digidoc::XmlConf</a>(<span class="stringliteral">&quot;&lt;file-path-and-name&gt;&quot;</span>));</div>
<div class="line"><span class="comment">// then initialize the library</span></div>
<div class="line"><a class="code hl_function" href="namespacedigidoc.html#a423ff81ab86454ae7c0913c04c2b3462">digidoc::initialize</a>();</div>
<div class="ttc" id="aclassdigidoc_1_1Conf_html_abbfddce7554787e43e53c93865e17aa7"><div class="ttname"><a href="classdigidoc_1_1Conf.html#abbfddce7554787e43e53c93865e17aa7">digidoc::Conf::init</a></div><div class="ttdeci">static void init(Conf *conf)</div><div class="ttdef"><b>Definition</b> Conf.cpp:63</div></div>
<div class="ttc" id="aclassdigidoc_1_1XmlConf_html"><div class="ttname"><a href="classdigidoc_1_1XmlConf.html">digidoc::XmlConf</a></div><div class="ttdoc">XML Configuration class.</div><div class="ttdef"><b>Definition</b> XmlConf.h:30</div></div>
<div class="ttc" id="anamespacedigidoc_html_a423ff81ab86454ae7c0913c04c2b3462"><div class="ttname"><a href="namespacedigidoc.html#a423ff81ab86454ae7c0913c04c2b3462">digidoc::initialize</a></div><div class="ttdeci">DIGIDOCPP_EXPORT void initialize(const std::string &amp;appInfo=&quot;libdigidocpp&quot;, initCallBack callBack=nullptr)</div><div class="ttdef"><b>Definition</b> Container.cpp:87</div></div>
</div><!-- fragment --><p> Local configuration settings can also be set or modified during runtime by calling out the respective set methods of XmlConf class. The digidoc::XMLConf class must be used in order to access all the configuration methods that are available.</p>
<h2><a class="anchor" id="parameters"></a>
Configuration parameters</h2>
<p>Configuration file's elements and their attribute names are defined in conf.xsd file. Below is a description of the configuration file's parameters. The attribute "lock", when set to "true" can optionally be used to determine parameter values which should not be overwritten by another configuration file (e.g. when using global and user's configuration files in parallel; see also the previous section for more information).</p>
<h3><a class="anchor" id="logging-settings"></a>
Logging settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>log.file </td><td>Location of the log file where the logging output is written, e.g. /tmp/digidocpp.log or C:\Temp\digidocpp.log If left unspecified then the logging output is written to standard output stream.   </td></tr>
<tr>
<td>log.level </td><td>Used for controlling the level of detail of the logging output messages, higher number value indicates higher level of detail. Possible values are: 1 – error messages, 2 – warning messages, 3 – info messages, 4 – debug messages.   </td></tr>
</table>
<h3><a class="anchor" id="TS-settings"></a>
Time-stamping service settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>ts.url </td><td>Specifies the URL of the time-stamping service that is used during signature creation, needed only in case of TS signature profile. By default, the RIA's time-stamping service is used by the library (<a href="https://eid-dd.ria.ee/ts">https://eid-dd.ria.ee/ts</a>)   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>For testing purposes, the SK's test time-stamping service can be used. The service is available at <a href="http://demo.sk.ee/tsa/">http://demo.sk.ee/tsa/</a> additional information can be found at <a href="https://www.id.ee/en/article/trust-services-timestamping-service/">https://www.id.ee/en/article/trust-services-timestamping-service/</a>.</dd></dl>
<h3><a class="anchor" id="VerifyService-settings"></a>
Signature Verify Service settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>verify.serivceUri </td><td>Specifies the URL of the signature-verify service that is used during signature validation. By default, the RIA's signature-verify service is used by the library (<a href="https://siva.eesti.ee/V3/validate">https://siva.eesti.ee/V3/validate</a>)   </td></tr>
</table>
<h3><a class="anchor" id="pkcs11-settings"></a>
PKCS#11 settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>pkcs11.driver.path </td><td>PKCS#11 driver library to be used when communicating with the smart card. With Estonian ID cards for example, the following PKCS#11 libraries are used: opensc-pkcs11.so (used in Linux environment) opensc-pkcs11.dll (used in Windows environment)   </td></tr>
</table>
<h3><a class="anchor" id="CA-settings"></a>
Trust anchor/TSL settings</h3>
<p>Information of trusted CA certificates (trust anchors) is used to validate the trustworthiness of certificates used in the signature during signing and signature validation processes. The signer certificate's CA, OCSP responder certificate and time-stamping service's certificate (also referred to as time-stamping authority, TSA) must be trusted.</p>
<p>Libdigidocpp library uses Trust Service Status List (TSL) as a source of trust anchor information (see also <a class="el" href="manual.html#TSL-overview">TSL list usage in Libdigidocpp</a> and <a class="el" href="manual.html#TSL">TSL standard</a> for more information). A TSL list is a signed XML file that contains data of trusted CA certificates, OCSP responder service and time-stamping service certificates. Note that since v3.10, only TSL lists' based trust anchors are supported by the library.</p>
<p>By default, the trusted certificates' information is obtained from European Commission's official TSL list (<a href="https://ec.europa.eu/tools/lotl/eu-lotl.xml">https://ec.europa.eu/tools/lotl/eu-lotl.xml</a>). The default TSL behaviour can be changed by altering the configuration parameters listed below.</p>
<dl class="section note"><dt>Note</dt><dd>- The TSL URL and TSL signing certificate values are not configurable via the digidocpp.conf configuration file. The default values are fixed in source code and can be accessed via methods <a class="el" href="classdigidoc_1_1Conf.html#ab9f072db46996436266d3f611414d7c5">digidoc::Conf::TSLCerts()</a> and <a class="el" href="classdigidoc_1_1Conf.html#a29c8ee1c698539dca1dc24c0fb0193c1">digidoc::Conf::TSLUrl()</a>. The library's user has to create a subclass and override the methods in order to define other values. See also <a class="el" href="manual.html#initialization">Initialization</a>. </dd>
<dd>
- When using digidoc-tool utility program then it is possible to specify necessary TSL parameters on the command line. See also <a class="el" href="manual.html#utility">Libdigidocpp utility program</a>. </dd>
<dd>
- For information about using test TSL lists with Libdigidocpp library, please refer to <a href="https://github.com/open-eid/libdigidocpp/wiki/Using-test-TSL-lists">https://github.com/open-eid/libdigidocpp/wiki/Using-test-TSL-lists</a></dd></dl>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>tsl.autoupdate </td><td>Determines if TSL validity is checked during every initialization of the library and if new TSL lists are downloaded if the existing list is expired. By default, the automatic update functionality is enabled and can be disabled by setting the parameter's value to "false". Note that when setting the parameter to "false" then you should copy the necessary TSL files to the "tsl.cache" location manually.  </td></tr>
<tr>
<td>tsl.cache </td><td>Directory in the file system where the TSL lists are saved and read in by the library. Set this parameter with your own value to change the default directories:<ul>
<li>in Windows environment: %APPDATA%\digidocpp\tsl,</li>
<li>in Linux ja OSX environments: $HOME/.digidocpp/tsl   </li>
</ul>
</td></tr>
<tr>
<td>tsl.onlineDigest </td><td><p class="starttd">Additional feature to optimize TSL updating process. By default, the value is "true", meaning that during each initialization of the library, it is checked if there is a newer TSL list published, even if the existing TSL list is not yet expired.</p>
<p class="intertd">The check is based on the TSL list's HTTP HEAD request ETag field or SHA-256 digest value.</p>
<ul>
<li>HTTP HEAD request is made to TSL's URL to get remote ETag and if the value doesn't correspond with the existing local TSL's ETag value then a newer version of the TSL list is downloaded. Otherwise, the existing TSL is used.</li>
<li>SHA-256 digest that is (optionally) published online by the TSL's owner/manager. The URL of the digest matches the TSL's URL, but extension .sha2 is used instead of .xml. If the digest can be read and the value doesn't correspond with the existing local TSL's SHA-256 digest then a newer version of the TSL list is downloaded. Otherwise, the existing TSL is used.  </li>
</ul>
</td></tr>
<tr>
<td>tsl.timeOut </td><td>TSL downloading timeout for each TSL list. The default value is 10 seconds.  </td></tr>
</table>
<h3><a class="anchor" id="proxy-settings"></a>
HTTP proxy settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>proxy.host </td><td>Specifies the proxy hostname, e.g. proxy.example.net  </td></tr>
<tr>
<td>proxy.port </td><td>Specifies the proxy port, e.g. 8080  </td></tr>
<tr>
<td>proxy.user </td><td>Specifies the proxy username.  </td></tr>
<tr>
<td>proxy.pass </td><td>Specifies the proxy password.  </td></tr>
<tr>
<td>proxy.tunnelSSL </td><td>May be used to enable downloading TSL-s in case of HTTPS connections and proxy. If enabled, the library tries to download use the proxy tunnel also for the HTTPS session.   </td></tr>
<tr>
<td>proxy.forceSSL </td><td>May be used to enable downloading TSL-s in case of HTTPS connections and proxy. If enabled then the library tries to pass by the proxy connection in case of HTTPS sessions.   </td></tr>
</table>
<h3><a class="anchor" id="digest-settings"></a>
Digest type settings</h3>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>signer.signatureDigestUri </td><td>Specifies the digest algorithm that is used when calculating the hash that is being signed. By default, the SHA-256 algorithm (with URI <a href="http://www.w3.org/2001/04/xmlenc#sha256">http://www.w3.org/2001/04/xmlenc#sha256</a>) is used  </td></tr>
<tr>
<td>signer.digestUri </td><td>Specifies the digest algorithm that is used for calculating all the hash values in the signature. By default, the SHA-256 algorithm is used  </td></tr>
</table>
<h3><a class="anchor" id="ocspresponder-settings"></a>
OCSP responder settings</h3>
<p>The default OCSP responder that the library uses for retrieving the OCSP confirmation during signature creation depends on the signer's certificate chain. In case of no issuer is configured AIA extension is used for OCSP responder settings</p>
<p>You change the default behaviour in the configuration file with the following parameter.</p>
<table class="doxtable">
<tr>
<th>Parameter name </th><th>Comments  </th></tr>
<tr>
<td>ocsp issuer </td><td>The "issuer" parameter's name stands for the signer certificate issuer's Common Name (CN) value, e.g. ESTEID-SK 2015. The element's value specifies OCSP responder server's URL address that is used for certificates issued from the respective CA chain.   </td></tr>
</table>
<h2><a class="anchor" id="sample-conf"></a>
Sample configuration file</h2>
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span>&lt;configuration xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;schema/conf.xsd&quot;&gt;</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span>    &lt;!--Logging settings--&gt;</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>    &lt;!--&lt;param name=&quot;log.level&quot; lock=&quot;false&quot;&gt;2&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>    &lt;!--&lt;param name=&quot;log.file&quot; lock=&quot;false&quot;&gt;/tmp/digidocpp.log&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span>    &lt;!--&lt;param name=&quot;log.file&quot; lock=&quot;false&quot;&gt;C:\Users\All Users\Documents\digidocpp.log&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>    &lt;!--Digest algorithm settings--&gt;</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>    &lt;!--&lt;param name=&quot;signer.digestUri&quot; lock=&quot;false&quot;&gt;http://www.w3.org/2001/04/xmlenc#sha256&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    &lt;!--&lt;param name=&quot;signer.signatureDigestUri&quot; lock=&quot;false&quot;&gt;http://www.w3.org/2001/04/xmlenc#sha256&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>    &lt;!--PKCS#11 driver’s location, if not using default driver--&gt;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>    &lt;!--&lt;param name=&quot;pkcs11.driver.path&quot; lock=&quot;false&quot;&gt;opensc-pkcs11.so&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>    &lt;!--HTTP proxy settings, if needed--&gt;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>    &lt;!--&lt;param name=&quot;proxy.forceSSL&quot; lock=&quot;false&quot;&gt;false&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>    &lt;!--&lt;param name=&quot;proxy.tunnelSSL&quot; lock=&quot;false&quot;&gt;true&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>    &lt;!--&lt;param name=&quot;proxy.host&quot; lock=&quot;false&quot;&gt;&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    &lt;!--&lt;param name=&quot;proxy.port&quot; lock=&quot;false&quot;&gt;&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    &lt;!--&lt;param name=&quot;proxy.user&quot; lock=&quot;false&quot;&gt;&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    &lt;!--&lt;param name=&quot;proxy.pass&quot; lock=&quot;false&quot;&gt;&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    &lt;!--Time-stamping service settings--&gt;</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>    &lt;!--&lt;param name=&quot;ts.url&quot; lock=&quot;false&quot;&gt;https://eid-dd.ria.ee/ts&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    &lt;!--TSL settings--&gt;</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    &lt;!--&lt;param name=&quot;tsl.autoupdate&quot; lock=&quot;false&quot;&gt;true&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>    &lt;!--&lt;param name=&quot;tsl.cache&quot; lock=&quot;false&quot;&gt;&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    &lt;!--&lt;param name=&quot;tsl.onlineDigest&quot; lock=&quot;false&quot;&gt;true&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    &lt;!--&lt;param name=&quot;tsl.timeOut&quot; lock=&quot;false&quot;&gt;10&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    &lt;!--Verify service settings--&gt;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    &lt;!--&lt;param name=&quot;verify.serivceUri&quot; lock=&quot;false&quot;&gt;https://siva.eesti.ee/V3/validate&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    &lt;!--OCSP BDoc-TM validation settings--&gt;</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    &lt;!--&lt;param name=&quot;ocsp.tm.profile&quot; lock=&quot;false&quot;&gt;1.3.6.1.4.1.10015.4.1.2&lt;/param&gt;--&gt;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    &lt;!--OCSP responder URL--&gt;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    &lt;!--&lt;ocsp issuer=&quot;ISSUER NAME&quot;&gt;http://ocsp.issuer.com&lt;/ocsp&gt;--&gt;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>&lt;/configuration&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="usage"></a>
Using Libdigidocpp API</h1>
<p>Note that Libdigidocpp uses internal memory buffers in case of all the operations, so that intermediary data is not written to temporary files on the disk. Also, the data files to be added to a DigiDoc container can be read from a data stream and later extracted from the container to a stream so that the data can be kept in memory.</p>
<h2><a class="anchor" id="initialization"></a>
Initialization</h2>
<p>Libdigidocpp's initialization method conducts the following operations:</p><ol type="1">
<li>initializes dependent libraries (see also <a class="el" href="manual.html#libraries">Software libraries</a>)</li>
<li>loads configuration settings from default configuration files</li>
<li>initializes trust anchors: initializes TSL lists. See <a class="el" href="manual.html#TSL-init">TSL initialization process</a> for more information about the TSL initialization process.</li>
</ol>
<p>If you would like to use non-default configuration settings then call out the configuration file's initialization before initializing the library, for example: </p><div class="fragment"><div class="line"><span class="comment">// Optionally initialize global configuration file to use non-default settings</span></div>
<div class="line"><a class="code hl_function" href="classdigidoc_1_1Conf.html#abbfddce7554787e43e53c93865e17aa7">digidoc::Conf::init</a>(<span class="keyword">new</span> <a class="code hl_class" href="classdigidoc_1_1XmlConf.html">digidoc::XmlConf</a>(<span class="stringliteral">&quot;&lt;file-path-and-name&gt;&quot;</span>));</div>
<div class="line"><span class="comment">// Initialize the library</span></div>
<div class="line"><a class="code hl_function" href="namespacedigidoc.html#a423ff81ab86454ae7c0913c04c2b3462">digidoc::initialize</a>();</div>
</div><!-- fragment --><p>The <a class="el" href="classdigidoc_1_1XmlConf.html" title="XML Configuration class.">digidoc::XmlConf</a> class must be used in order to access all the configuration methods that are available.</p>
<dl class="section note"><dt>Note</dt><dd>If you would like to use different configuration values that are fixed as constants in the <a class="el" href="classdigidoc_1_1Conf.html" title="Configuration class which can reimplemented and virtual methods overloaded.">digidoc::Conf</a> configuration class then it is possible to extend the class and override the values that need to be reset.</dd></dl>
<h2><a class="anchor" id="creating"></a>
Creating and signing a DigiDoc document (local signing)</h2>
<h3><a class="anchor" id="containercreate"></a>
Creating a DigiDoc container</h3>
<p>Create a new container object and specify the DigiDoc document's type, for example: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> doc = <a class="code hl_function" href="classdigidoc_1_1Container.html#a1ad76d44979f8be4aba1d8c5540f84aa">digidoc::Container::createPtr</a>(<span class="stringliteral">&quot;&lt;output-file&#39;s-path&gt;&quot;</span>); <span class="comment">// create new container</span></div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_a1ad76d44979f8be4aba1d8c5540f84aa"><div class="ttname"><a href="classdigidoc_1_1Container.html#a1ad76d44979f8be4aba1d8c5540f84aa">digidoc::Container::createPtr</a></div><div class="ttdeci">static std::unique_ptr&lt; Container &gt; createPtr(const std::string &amp;path)</div><div class="ttdef"><b>Definition</b> Container.cpp:298</div></div>
</div><!-- fragment --><p> Container class is used to incorporate the data of a DigiDoc document.</p>
<h3><a class="anchor" id="adddatafile"></a>
Adding data files</h3>
<p>Data files can be added to a DigiDoc container in two alternative ways:</p><ol type="1">
<li>adding the data from an input stream (i.e. the data file contents can be read from internal memory buffer): <div class="fragment"><div class="line">std::unique_ptr&lt;std::istream&gt; is = ...;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1Container.html#a0d48d9d10e34a8dbd4b987d510b8258c">digidoc::Container::addDataFile</a>(std::move(is), <span class="comment">// input stream</span></div>
<div class="line">    <span class="keyword">const</span> std::string &amp;fileName, <span class="comment">// file name that is written to the container</span></div>
<div class="line">    <span class="keyword">const</span> std::string &amp;mediaType); <span class="comment">// mime type of the data file</span></div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_a0d48d9d10e34a8dbd4b987d510b8258c"><div class="ttname"><a href="classdigidoc_1_1Container.html#a0d48d9d10e34a8dbd4b987d510b8258c">digidoc::Container::addDataFile</a></div><div class="ttdeci">virtual void addDataFile(const std::string &amp;path, const std::string &amp;mediaType)=0</div></div>
</div><!-- fragment --></li>
<li>adding the data by reading the it from file system <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1Container.html#a0d48d9d10e34a8dbd4b987d510b8258c">digidoc::Container::addDataFile</a>(<span class="keyword">const</span> std::string &amp;path, <span class="comment">//data file&#39;s name and path in file system</span></div>
<div class="line">    <span class="keyword">const</span> std::string &amp;mediaType); <span class="comment">// mime type of the data file</span></div>
</div><!-- fragment --></li>
</ol>
<p>Parameter mediaType in the methods above stands for a MIME type of the data file, for example "text/plain" or "application/msword". Value "application/octet-stream" is used by default. Calling out any of the methods listed above shall create a new DataFile object and add it to the DigiDoc container's data file collection. Note that in order to add a data file to a container, the container has to be unsigned and there shouldn't be an existing data file with the same name in the container. If a container is signed then it is possible to add data files to it only after the signatures are removed.</p>
<dl class="section warning"><dt>Warning</dt><dd>- It is important to pay attention that the data file's mime type value in manifest.xml file and in signatures*.xml file's &lt;DataObjectFormat&gt;&lt;MimeType&gt; element are the same, otherwise the signature is invalid! In case of the ordinary signature creation process, the library sets the correct value automatically. However, if you create a ASiC-E container with Libdigidocpp library and want to add signatures*.xml file that you have received from another source then make sure that the data files' mime-type values in manifest-xml file and in signatures*.xml file are the same.</dd>
<dd>
- Data file’s mime-type value must be formatted as specified in RFC2045, section 5.1 (<a href="https://tools.ietf.org/html/rfc2045#section-5.1">https://tools.ietf.org/html/rfc2045#section-5.1</a>), i.e. the "type" and "subtype" values must be separated with a forward slash character.</dd>
<dd>
- It is recommended not to use special characters in the data file’s name, i.e. it is suggested to only use the characters that are categorized as "unreserved" according to RFC3986 (<a href="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</a>).</dd></dl>
<dl class="section note"><dt>Note</dt><dd>By default, it is recommended to use data file mime-type value "application/octet-stream" for all file types.</dd></dl>
<h3><a class="anchor" id="API-add-sign"></a>
Adding signatures</h3>
<p>It is possible to add a signature to a container only if it contains at least one data file, multiple signatures can be added to a single container. The signer's certificate and PIN code to access the private signature key are required during signing.</p>
<dl class="section note"><dt>Note</dt><dd>Libdigidocpp library uses TSL lists (Trust Service Status list) to obtain information about trusted certificates during signature creation process. See also <a class="el" href="manual.html#TSL-overview">TSL overview</a>, <a class="el" href="manual.html#TSL">TSL standard</a> and <a class="el" href="manual.html#CA-settings">Configuring TSL settings</a>.</dd></dl>
<p>Signing can be done by using PKCS#11 module for accessing the signature token. PKCS#11 module is the default module for singing with smart card (e.g. Estonian ID card or any other smart card provided that you have the external native language PKCS#11 driver for it). See also <a class="el" href="manual.html#pkcs11-settings">PKCS#11 settings</a>. </p><div class="fragment"><div class="line"><a class="code hl_class" href="classdigidoc_1_1PKCS11Signer.html">digidoc::PKCS11Signer</a> *signer = <span class="keyword">new</span> <a class="code hl_class" href="classdigidoc_1_1PKCS11Signer.html">digidoc::PKCS11Signer</a>(<span class="stringliteral">&quot;&lt;PKCS11-driver-path&gt;&quot;</span>);</div>
<div class="line"><span class="comment">// optionally specify PKCS#11 driver&#39;s location. If left  unspecified then location is</span></div>
<div class="line"><span class="comment">// looked up from configuration file&#39;s parameter &quot;pkcs11.driver.path&quot;.</span></div>
<div class="line">std::string pin = <span class="stringliteral">&quot;&lt;pin-code&gt;&quot;</span>; <span class="comment">//PIN2 in case of Estonian ID cards</span></div>
<div class="line">signer-&gt;<a class="code hl_function" href="classdigidoc_1_1PKCS11Signer.html#ab51b4c5707f29989c85b9fb883336e82">setPin</a>(pin);</div>
<div class="ttc" id="aclassdigidoc_1_1PKCS11Signer_html"><div class="ttname"><a href="classdigidoc_1_1PKCS11Signer.html">digidoc::PKCS11Signer</a></div><div class="ttdoc">Implements Signer interface for ID-Cards, which support PKCS#11 protocol.</div><div class="ttdef"><b>Definition</b> PKCS11Signer.h:27</div></div>
<div class="ttc" id="aclassdigidoc_1_1PKCS11Signer_html_ab51b4c5707f29989c85b9fb883336e82"><div class="ttname"><a href="classdigidoc_1_1PKCS11Signer.html#ab51b4c5707f29989c85b9fb883336e82">digidoc::PKCS11Signer::setPin</a></div><div class="ttdeci">void setPin(const std::string &amp;pin)</div><div class="ttdef"><b>Definition</b> PKCS11Signer.cpp:338</div></div>
</div><!-- fragment --><p> If you would like to add PIN insertion dialog window for the signer to enter the PIN code then you can write a new class which extends the PKCS11Signer class, overwrite the std::string pin(const X509Cert &amp;cert) method and write your own PIN dialog implementation code there.</p>
<h4><a class="anchor" id="API-sign-profile"></a>
Optionally specify the signature profile</h4>
<p>The supported signature profiles are (see also <a class="el" href="manual.html#Supported">Supported functional properties</a>, under "Signature profiles"):</p><ul>
<li>"time-stamp" (TS) - signature profile in case of which the certificate validity information is added to the signature with an OCSP confirmation (retrieved from OCSP server); the signing time information is added with a time-stamp token (retrieved from a time-stamping service). Signature creation time is the issuance time of the time-stamp token (value of the getTime field in the token).</li>
</ul>
<p>If the signature profile value is not specified then then a "time-stamp" profile is used by default.</p>
<p>Set the profile value as follows: </p><div class="fragment"><div class="line">std::string profile = <span class="stringliteral">&quot;time-stamp&quot;</span>; <span class="comment">// or &quot;time-stamp-archive&quot;</span></div>
<div class="line">signer-&gt;<a class="code hl_function" href="classdigidoc_1_1Signer.html#acb96096d6b5ea03dbc5026a7aabc41c4">setProfile</a>(profile);</div>
<div class="ttc" id="aclassdigidoc_1_1Signer_html_acb96096d6b5ea03dbc5026a7aabc41c4"><div class="ttname"><a href="classdigidoc_1_1Signer.html#acb96096d6b5ea03dbc5026a7aabc41c4">digidoc::Signer::setProfile</a></div><div class="ttdeci">void setProfile(const std::string &amp;profile)</div><div class="ttdef"><b>Definition</b> Signer.cpp:175</div></div>
</div><!-- fragment --><h4><a class="anchor" id="API-sign-data"></a>
Optionally specify additional signer's data</h4>
<p>Signature production place and signer role are optional signed meta-data about the signature. If left unspecified then the respective elements in the signatures*.xml file are created with no contents. </p><div class="fragment"><div class="line">std::string city, state, postalCode, country;</div>
<div class="line">std::vector&lt;std::string&gt; roles;</div>
<div class="line">signer-&gt;<a class="code hl_function" href="classdigidoc_1_1Signer.html#a811829fbc4a70a487301e194c1a09f76">setSignatureProductionPlace</a>(city, state, postalCode, country); <span class="comment">// location where the signature is created</span></div>
<div class="line">signer-&gt;<a class="code hl_function" href="classdigidoc_1_1Signer.html#a9c34490317e1eafd25661acb22b0d981">setSignerRoles</a>(roles); <span class="comment">// role(s) of the signer</span></div>
<div class="ttc" id="aclassdigidoc_1_1Signer_html_a811829fbc4a70a487301e194c1a09f76"><div class="ttname"><a href="classdigidoc_1_1Signer.html#a811829fbc4a70a487301e194c1a09f76">digidoc::Signer::setSignatureProductionPlace</a></div><div class="ttdeci">void setSignatureProductionPlace(const std::string &amp;city, const std::string &amp;stateOrProvince, const std::string &amp;postalCode, const std::string &amp;countryName)</div><div class="ttdef"><b>Definition</b> Signer.cpp:77</div></div>
<div class="ttc" id="aclassdigidoc_1_1Signer_html_a9c34490317e1eafd25661acb22b0d981"><div class="ttname"><a href="classdigidoc_1_1Signer.html#a9c34490317e1eafd25661acb22b0d981">digidoc::Signer::setSignerRoles</a></div><div class="ttdeci">void setSignerRoles(const std::vector&lt; std::string &gt; &amp;signerRoles)</div><div class="ttdef"><b>Definition</b> Signer.cpp:198</div></div>
</div><!-- fragment --><h4><a class="anchor" id="API-signature-hash"></a>
Optionally specify signature digest method</h4>
<p>By default, the hash that is being signed is calculated with SHA-256 algorithm. You can also use a different digest algorithm for calculating the hash that is signed (this does not affect calculating other hash values). For that, use the <a class="el" href="classdigidoc_1_1Signer.html#a062d17798a9b1ebbbd524f9b0527061c">digidoc::Signer::setMethod(const std::string &amp;method)</a> method.</p>
<h4><a class="anchor" id="API-sign-create"></a>
Create the signature</h4>
<p>The signing method also adds validation data from external services (OCSP and time-stamping servers). Note that the OCSP responder and time-stamping server settings (in case of TS profile) should be configured before calling out the following method (see also <a class="el" href="manual.html#initialization">Initialization</a> and <a class="el" href="manual.html#parameters">Configuration parameters</a>). By default, the RIA's time-stamping service <a href="https://eid-dd.ria.ee/ts">https://eid-dd.ria.ee/ts</a> is used. Container holds the Signature object reference and there is no need cleanup memory.</p>
<div class="fragment"><div class="line">Signature *signature = doc-&gt;sign(signer);</div>
</div><!-- fragment --><h4><a class="anchor" id="validatesig"></a>
Validating the created signatures</h4>
<p>After the signature has been added to the container, it should be validated before writing the signed container to an output file. For validating the signature, do as follows: </p><div class="fragment"><div class="line">signature-&gt;validate();</div>
</div><!-- fragment --><p> The validation method above validates the signed data files', signer certificate's and OCSP confirmation's correspondence to the signature value. Note that the validation method above does not validate other signatures which may belong to the same container.</p>
<dl class="section note"><dt>Note</dt><dd>See also <a class="el" href="manual.html#validate">Validating signature containers and signatures</a> about more information for validating existing signatures and signature containers.</dd></dl>
<h4><a class="anchor" id="savesig"></a>
Save container changes</h4>
<p>After the signature has been added and validated, container changes should be saved (<a class="el" href="manual.html#containeropen">Reading and writing DigiDoc documents</a>): </p><div class="fragment"><div class="line">doc-&gt;save();</div>
</div><!-- fragment --><h2><a class="anchor" id="websigning"></a>
Creating and signing a DigiDoc document (external signing, e.g. in browser)</h2>
<p>External signing (two-step signing) can be used in case of signing in web applications, where the signature value is calculated externally, via a browser plug-in or extension.</p>
<p>In order to conduct web signing with Libdigidocpp library, do as follows: Container holds the Signature object reference and there is no need cleanup memory.</p>
<ol type="1">
<li>In Container class, prepare signature XML structure: <div class="fragment"><div class="line">Signature *signature = doc-&gt;prepareSignature(signer);</div>
</div><!-- fragment --></li>
<li>In Signature class, get the hash to be signed in browser: <div class="fragment"><div class="line">std::vector&lt;unsigned char&gt; dataToSign = signature-&gt;dataToSign();</div>
<div class="line">std::vector&lt;unsigned char&gt; signatureMethod = signature-&gt;signatureMethod();</div>
<div class="line">std::string <span class="keywordtype">id</span> = signature-&gt;id();</div>
</div><!-- fragment --> ID can be used when container is saved with <a class="el" href="classdigidoc_1_1Container.html#ab5ea778c845480142353dd47aa0dbd61">digidoc::Container::save</a> and later reloaded to locate signature object.</li>
<li>Sign the hash in browser (e.g. use the <a href="https://github.com/open-eid/hwcrypto.js">hwcrypto.js library</a>)</li>
<li>Add RSA or ECDSA signature value to the signature XML structure: When container was stored on disk before reload container with <a class="el" href="classdigidoc_1_1Container.html#a30efc4cd037d1bbb49fae579ff28e48b">digidoc::Container::open</a> and use <a class="el" href="classdigidoc_1_1Container.html#a3b31e14a4d2ce6a14f72c8eabd45c535">digidoc::Container::signatures()</a> to enumerate signatures to locate correct object with previosly selected ID. <div class="fragment"><div class="line">std::vector&lt;unsigned char&gt; signatureValue = ...;</div>
<div class="line">signature-&gt;setSignatureValue(signatureValue);</div>
</div><!-- fragment --></li>
<li>Add time-stamp and OCSP data to Signature object, according to the signature's profile (see also section <a class="el" href="manual.html#API-sign-profile">Optionally specify the signature profile</a> for more information): <div class="fragment"><div class="line">signature-&gt;extendSignatureProfile(signer);</div>
</div><!-- fragment --></li>
<li>Write the document to output, as specified in section <a class="el" href="manual.html#containeropen">Reading and writing DigiDoc documents</a></li>
</ol>
<h2><a class="anchor" id="containeropen"></a>
Reading and writing DigiDoc documents</h2>
<p>In order to read an existing DigiDoc file from the file system, do as follows: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> doc = <a class="code hl_function" href="classdigidoc_1_1Container.html#a484e3d875a9bb7a9b64a5ded7bf59fe6">digidoc::Container::openPtr</a>(<span class="stringliteral">&quot;&lt;input-file&#39;s-path&gt;&quot;</span>);</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_a484e3d875a9bb7a9b64a5ded7bf59fe6"><div class="ttname"><a href="classdigidoc_1_1Container.html#a484e3d875a9bb7a9b64a5ded7bf59fe6">digidoc::Container::openPtr</a></div><div class="ttdeci">static std::unique_ptr&lt; Container &gt; openPtr(const std::string &amp;path)</div><div class="ttdef"><b>Definition</b> Container.cpp:352</div></div>
</div><!-- fragment --><p> The method above reads in the DigiDoc file from the specified location in file system and creates the respective Container object representing the document's data. The file's structure is also validated during its parsing according to the corresponding standards.</p>
<p>Write a DigiDoc file (represented with a Container object) to file system with the following method: </p><div class="fragment"><div class="line"><a class="code hl_function" href="classdigidoc_1_1Container.html#ab5ea778c845480142353dd47aa0dbd61">digidoc::Container::save</a>(<span class="stringliteral">&quot;&lt;output-file&#39;s-path&gt;&quot;</span>);</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_ab5ea778c845480142353dd47aa0dbd61"><div class="ttname"><a href="classdigidoc_1_1Container.html#ab5ea778c845480142353dd47aa0dbd61">digidoc::Container::save</a></div><div class="ttdeci">virtual void save(const std::string &amp;path=&quot;&quot;)=0</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>In case of read-only formats (e.g. ASiC-S documents), the save will throw a <a class="el" href="classdigidoc_1_1Exception.html" title="Base exception class of the digidoc implementation.">digidoc::Exception</a>.</dd></dl>
<h2><a class="anchor" id="validate"></a>
Validating signature containers and signatures</h2>
<p>Validation of a signed DigiDoc document consists of three main steps:</p><ol type="1">
<li>Call out the main validation method of the library. If there are multiple validation errors then get the errors list.</li>
<li>Check for additional errors/warnings (separate implementation);</li>
<li>Determine the validation status of the document (according to the returned error codes and validation status priorities).</li>
</ol>
<h3><a class="anchor" id="main-method"></a>
Using the main validation method</h3>
<p>You can validate a signature and its validation data - OCSP confirmation and time-stamp (in case of TS profile) - with method: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1Signature.html#ae7025a0a13b01f4949f600774c720a2d">digidoc::Signature::validate</a>();</div>
<div class="ttc" id="aclassdigidoc_1_1Signature_html_ae7025a0a13b01f4949f600774c720a2d"><div class="ttname"><a href="classdigidoc_1_1Signature.html#ae7025a0a13b01f4949f600774c720a2d">digidoc::Signature::validate</a></div><div class="ttdeci">virtual void validate() const =0</div></div>
</div><!-- fragment --><p> If an exception is thrown from the validation method then the signature can be either <b>INVALID</b> or <b>VALID WITH WARNINGS</b>; otherwise the signature is VALID. Before determining the final validation status, additional errors must be checked, as described in the following chapters.</p>
<p>If an exception is thrown then its causes can be retrieved with the following method: </p><div class="fragment"><div class="line">std::vector&lt;digidoc::Exception&gt; <a class="code hl_function" href="classdigidoc_1_1Exception.html#a3f3251fd0a61ed3dbb07235535fb09cc">digidoc::Exception::causes</a>();</div>
<div class="ttc" id="aclassdigidoc_1_1Exception_html_a3f3251fd0a61ed3dbb07235535fb09cc"><div class="ttname"><a href="classdigidoc_1_1Exception.html#a3f3251fd0a61ed3dbb07235535fb09cc">digidoc::Exception::causes</a></div><div class="ttdeci">Causes causes() const</div><div class="ttdef"><b>Definition</b> Exception.cpp:187</div></div>
</div><!-- fragment --><h3><a class="anchor" id="additional"></a>
Checking for additional errors/warnings</h3>
<p>There is a validation case that is not checked in the default validation method of the library, instead, separate method for checking this specific situation has to be implemented by the library’s user. In Libdigidocpp library, checking for an old file format must be done separately.</p>
<p>The following subchapter describes how this check can be implemented. After checking for old signature format errors/warnings, collect all of the error codes and continue with determining the validation status as described in the next chapter. It is possible to check the source code of digidoc-tool or DigiDoc desktop application, accessible from <a href="https://github.com/open-eid/DigiDoc4-Client">https://github.com/open-eid/DigiDoc4-Client</a>.</p>
<h3><a class="anchor" id="validation-status"></a>
Determining the validation status</h3>
<p>After validating the signed DigiDoc document, the validation result must be determined by the library's user. Final validation result must be one of the possible validation statuses that are described in the table below, the status must be chosen according to its priority. The validation status priorities have to be applied in two cases:</p><ol type="1">
<li><b>Returning a validation result of a single signature:</b><br  />
 If there are more than one validation errors that occur when validating a single signature in DigiDoc container then the overall status of the signature should be chosen according to the status priorities.</li>
<li><b>Returning a validation result of the whole DigiDoc container:</b><br  />
 If there are more than one signatures in a DigiDoc container and the signatures have different validation statuses or validation of the container structure returns a different status then the overall status of the DigiDoc file should be chosen according to the status priorities.</li>
</ol>
<p><b>NB! User of the library has to determine the validation status according to the error code that is returned by the library's validation method.</b> </p><table class="doxtable">
<tr>
<th>Priority </th><th>Status </th><th>Error code </th><th>Description  </th></tr>
<tr>
<td>1 </td><td>INDETERMINATE/UNKNOWN </td><td><b>10</b> CertificateIssuerMissing (signer's certificate is unknown)<br  />
 <b>6</b> CertificateUnknown (OCSP responder certificate is unknown) </td><td><p class="starttd">Validation process determines that one or more of the certificates included in the document are unknown or not trusted, i.e. the certificates have been issued by an unknown Certificate Authority (the CA has not been added to trusted list). Notes:</p><ul>
<li>The file and signature(s) are not legally valid.</li>
<li>If the CA will later be added to the trusted list/trust store then the validation status can change to any of the other statuses described in the current table.</li>
</ul>
<p class="intertd">Suggested warning message (also displayed in DigiDoc desktop application): "Signature status is displayed as unknown if you don't have all validity confirmation service certificates and/or certificate authority certificates available in TSL"<br  />
</p>
<ul>
<li>Sample file: unknown_CA_TS.asice (BDOC 2.1, time-stamp profile)</li>
<li>Sample file: unknown_CA_TM.asice (BDOC 2.1, time-mark profile)  </li>
</ul>
</td></tr>
<tr>
<td>2 </td><td>INVALID </td><td>All errors except of the ones that are regarded as warnings by the library's user. </td><td><p class="starttd">Validation process returns error(s), the errors have not been explicitly determined as minor error(s) by the library's user.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The file and signature(s) are not legally valid.</li>
<li>No further alterations should be made to the file, i.e. no signatures should be added or removed.  </li>
</ul>
</dd></dl>
</td></tr>
<tr>
<td>3 </td><td>VALID WITH WARNINGS </td><td>See the next section. </td><td>Validation process returns error(s) that have been previously explicitly categorized (by the library's user) as minor technical errors. Note that this status is used only in exceptional cases, more details of which are given in the next chapter. <dl class="section note"><dt>Note</dt><dd><ul>
<li>The file and signature(s) are handled as legally valid.</li>
<li>The error(s) are regarded as validation warnings.</li>
<li>Validation warnings should be displayed to the user.</li>
<li>No further alterations should be made to the file, i.e. no signatures should be added or removed.</li>
<li>Creator of the file should be informed about the error situation.  </li>
</ul>
</dd></dl>
</td></tr>
<tr>
<td>4 </td><td>VALID </td><td>N/A </td><td>Validation process returns no errors. The signature is legally valid.  </td></tr>
</table>
<p>The error codes described in the table above are defined in Exception.h source file.</p>
<p>Sample code of DigiDoc file validation can be found from digidoc-tool.cpp utility program, from the following method: </p><div class="fragment"><div class="line">open(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]); <span class="comment">//utility program&#39;s command &quot;open&quot;</span></div>
</div><!-- fragment --><h4><a class="anchor" id="validatewarnings"></a>
Validation status VALID WITH WARNINGS</h4>
<p>In special cases, validation errors can be regarded as minor technical errors and the file's validation status can be regarded as VALID WITH WARNINGS instead.</p>
<dl class="section warning"><dt>Warning</dt><dd>User of the DigiDoc library has to decide on his/her own when to use VALID WITH WARNINGS status instead of INVALID: there may be different interpretations of the severity of validation errors in different information systems then the final decision when to use this status has to be made by the library's user according to the requirements of the specific information system.</dd></dl>
<p>It is recommended to use the validation status VALID WITH WARNINGS in case of the error situations that are included in the table below - these error situations are regarded as VALID WITH WARNINGS in DigiDoc applications and software libraries, including:</p><ul>
<li>DigiDoc desktop application,</li>
<li>Libdigidocpp and DigiDoc4j software libraries' utility programs.</li>
</ul>
<p><b>Table 1. Validation error codes recommended to be handled as VALID WITH WARNINGS</b></p>
<table class="doxtable">
<tr>
<th>Error code </th><th>Related DigiDoc file format </th><th>Description  </th></tr>
<tr>
<td><b>12</b> RefereneceDigest Weak<br  />
 <b>13</b> SignatureDigestWeak </td><td>BDOC 2.1 / ASiC </td><td><p class="starttd">Weaker digest method (SHA-1) has been used than recommended when calculating either &lt;Reference&gt; or &lt;Signature&gt; element's digest value.</p>
<p class="intertd">Suggested warning message (also displayed in DigiDoc desktop application): "The current DigiDoc container uses weaker encryption method than officially accepted in Estonia."</p>
<ul>
<li>Sample file: weak-sha1-warning-TS.asice (time-stamp profile)</li>
<li>Sample file: weak-sha1-warning-TM.bdoc (time-mark profile)  </li>
</ul>
</td></tr>
<tr>
<td><b>16</b> ProducedATLateWarning </td><td>BDOC 2.1 TS / ASiC </td><td><p class="starttd">The difference between time-stamp issuance time (genTime value) and OCSP response's issuance time (producedAt value) exceeds 15 minutes but is less than 24 hours.</p>
<p class="intertd">Suggested warning message: "Time-stamp and OCSP issuance time difference is over 15 minutes."</p>
<ul>
<li>Sample file: TS_OCPS_difference_exceeds_15min.asice  </li>
</ul>
</td></tr>
<tr>
<td><b>14</b> DataFileNameSpaceWarning </td><td>DDOC 1.0<br  />
 DDOC 1.1<br  />
 DDOC 1.2<br  />
 DDOC 1.3 </td><td><p class="starttd">&lt;DataFile&gt; element's xmlns attribute is missing.</p>
<p class="intertd">Suggested warning message (also displayed in DigiDoc desktop application): "This DigiDoc documents has not been created according to specification, but the digital signatures is legally valid. You are not allowed to add or remove signatures to this container."</p>
<p class="intertd">More info: <a href="https://www.id.ee/en/article/digital-signing-and-electronic-signatures/">https://www.id.ee/en/article/digital-signing-and-electronic-signatures/</a></p>
<ul>
<li>Sample file: datafile_xmlns_missing.ddoc  </li>
</ul>
</td></tr>
<tr>
<td><b>15</b> IssuerNameSpace Warning </td><td>DDOC 1.1<br  />
 DDOC 1.2<br  />
 DDOC 1.3 </td><td><p class="starttd">&lt;IssuerSerial&gt;&lt;X509IssuerName&gt; and/or &lt;IssuerSerial&gt;&lt;X509SerialNumber&gt; element's xmlns attribute is missing.</p>
<p class="intertd">Suggested warning message (also displayed in DigiDoc desktop application): "This DigiDoc documents has not been created according to specification, but the digital signatures is legally valid. You are not allowed to add or remove signatures to this container."</p>
<p class="intertd">More info: <a href="https://www.id.ee/en/article/digital-signing-and-electronic-signatures/">https://www.id.ee/en/article/digital-signing-and-electronic-signatures/</a></p>
<ul>
<li>Sample file: issuerserial_xmlns_missing.ddoc  </li>
</ul>
</td></tr>
<tr>
<td>N/A (Separate error code has not been determined. </td><td>DDOC 1.0<br  />
 DDOC 1.1<br  />
 DDOC 1.2 </td><td><p class="starttd">DigiDoc file's version is older than currently supported. Note that the error situation affects only the container and not the signatures, therefore, in DigiDoc libraries, it is returned and displayed only at container level.</p>
<p class="intertd">Suggested warning message (also displayed in DigiDoc desktop application): "The current file is a DigiDoc container that is not supported officially any longer. You are not allowed to add or remove signatures to this container"</p>
<p class="intertd">More info: <a href="https://www.id.ee/en/article/digidoc-container-format-life-cycle-2/">https://www.id.ee/en/article/digidoc-container-format-life-cycle-2/</a></p>
<ul>
<li>Sample file: old_digidoc_format_1.0.ddoc   </li>
</ul>
</td></tr>
</table>
<h3><a class="anchor" id="validation-info"></a>
Additional information about validation</h3>
<h4><a class="anchor" id="validation-overview"></a>
Overview of validation activities</h4>
<p>Overview of validation activities is as follows:</p><ol type="1">
<li>checking that all the data files and signature’s meta-data (signer’s role, etc.) are included in the signature by calculating the data objects’ digest values and comparing them with the &lt;Reference&gt; element values in the signature;</li>
<li>checking that the claimed signer’s certificate is the actual certificate that was used for signing; checking that the "Non-repudiaton" value is set in the "Key Usage" extension of the signer’s certificate;</li>
<li>checking that the signature value is correct by decrypting the value with the signer’s public key and comparing the result with digest calculated from &lt;SignedInfo&gt; element block;</li>
<li>case of time-stamp corresponds to the signature value (by comparing the digest value of &lt;SignatureValue&gt; element’s value and TS response’s digest value);</li>
<li>checking that the OCSP response confirms the signer certificate’s validity and case of time-mark corresponds to the signature value (by comparing the digest value of &lt;SignatureValue&gt; element’s value and OCSP response’s nonce value);</li>
<li>checking that the signer’s, TSA and OCSP responder’s certificates are trusted (i.e. the certificates’ issuers are registered in trust store).</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Libdigidocpp library uses TSL lists (Trust Service Status list) to obtain information about trusted certificates during signature validation process. See also <a class="el" href="manual.html#TSL-overview">TSL overview</a>, <a class="el" href="manual.html#TSL">TSL standard</a> and <a class="el" href="manual.html#CA-settings">Configuring TSL settings</a>.</dd></dl>
<h2><a class="anchor" id="extracting"></a>
Extracting data files</h2>
<p>A data file can be extracted from container and written to the specified location in the file system or to an output stream.</p><ol type="1">
<li>You can write the data file to a stream and keep it in memory: <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1DataFile.html#a1a1499e6a88783152cceca8ff1b54ffc">digidoc::DataFile::saveAs</a>(std::ostream &amp;os);</div>
<div class="ttc" id="aclassdigidoc_1_1DataFile_html_a1a1499e6a88783152cceca8ff1b54ffc"><div class="ttname"><a href="classdigidoc_1_1DataFile.html#a1a1499e6a88783152cceca8ff1b54ffc">digidoc::DataFile::saveAs</a></div><div class="ttdeci">virtual void saveAs(std::ostream &amp;os) const =0</div></div>
</div><!-- fragment --></li>
<li>The file can be written to file system with the following method: <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1DataFile.html#a1a1499e6a88783152cceca8ff1b54ffc">digidoc::DataFile::saveAs</a>(<span class="keyword">const</span> std::string &amp;path);</div>
</div><!-- fragment --></li>
</ol>
<p>List of all the document’s data files can be retrieved with the following method: </p><div class="fragment"><div class="line">std::vector&lt;digidoc::DataFile&gt; <a class="code hl_function" href="classdigidoc_1_1Container.html#a43aab553405e4ebd2a33c13e8a372981">digidoc::Container::dataFiles</a>();</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_a43aab553405e4ebd2a33c13e8a372981"><div class="ttname"><a href="classdigidoc_1_1Container.html#a43aab553405e4ebd2a33c13e8a372981">digidoc::Container::dataFiles</a></div><div class="ttdeci">virtual std::vector&lt; DataFile * &gt; dataFiles() const =0</div></div>
</div><!-- fragment --><p>For example, read in a DigiDoc document and write its data files to file system as follows: </p><div class="fragment"><div class="line"><a class="code hl_class" href="classdigidoc_1_1Container.html">digidoc::Container</a> doc(<span class="stringliteral">&quot;&lt;input-file’s-path&gt;&quot;</span>); <span class="comment">// read in a document</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keyword">const</span> <a class="code hl_class" href="classdigidoc_1_1DataFile.html">digidoc::DataFile</a> &amp;file: doc.dataFiles()){ <span class="comment">// get the data files’ list</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        std::string dst = file.fileName(); <span class="comment">// get the data file’s name</span></div>
<div class="line">        file.saveAs(dst); <span class="comment">// save the data file to working directory</span></div>
<div class="line">    } <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code hl_class" href="classdigidoc_1_1Exception.html">digidoc::Exception</a> &amp;e) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;  Document %s extraction: FAILED\n&quot;</span>, file.fileName().c_str());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html"><div class="ttname"><a href="classdigidoc_1_1Container.html">digidoc::Container</a></div><div class="ttdoc">Offers functionality for handling data files and signatures in a container.</div><div class="ttdef"><b>Definition</b> Container.h:49</div></div>
<div class="ttc" id="aclassdigidoc_1_1DataFile_html"><div class="ttname"><a href="classdigidoc_1_1DataFile.html">digidoc::DataFile</a></div><div class="ttdoc">Data file wrapper providing methods for handling signed files or files to be signed in Container.</div><div class="ttdef"><b>Definition</b> DataFile.h:30</div></div>
<div class="ttc" id="aclassdigidoc_1_1Exception_html"><div class="ttname"><a href="classdigidoc_1_1Exception.html">digidoc::Exception</a></div><div class="ttdoc">Base exception class of the digidoc implementation.</div><div class="ttdef"><b>Definition</b> Exception.h:30</div></div>
</div><!-- fragment --><h2><a class="anchor" id="removing"></a>
Removing signatures and data files</h2>
<p>In order to remove a signature from DigiDoc document, use the following method: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1Container.html#acd0624f347e42029aa9f07da2eaf9293">digidoc::Container::removeSignature</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_acd0624f347e42029aa9f07da2eaf9293"><div class="ttname"><a href="classdigidoc_1_1Container.html#acd0624f347e42029aa9f07da2eaf9293">digidoc::Container::removeSignature</a></div><div class="ttdeci">virtual void removeSignature(unsigned int index)=0</div></div>
</div><!-- fragment --><p>Data files can be removed from a container only after all of its signatures have been removed. Use the following method to remove a data file from DigiDoc container: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classdigidoc_1_1Container.html#a3e4d73c8c9988c79b74e90d2d2315777">digidoc::Container::removeDataFile</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span>);</div>
<div class="ttc" id="aclassdigidoc_1_1Container_html_a3e4d73c8c9988c79b74e90d2d2315777"><div class="ttname"><a href="classdigidoc_1_1Container.html#a3e4d73c8c9988c79b74e90d2d2315777">digidoc::Container::removeDataFile</a></div><div class="ttdeci">virtual void removeDataFile(unsigned int index)=0</div></div>
</div><!-- fragment --><p>"Id" parameters of the abovementioned methods represent the signature’s and data file’s sequence numbers in the container. The identifiers are determined when a data file or signature is added to the container, counting starts from zero. </p><dl class="section note"><dt>Note</dt><dd>The functionality of modifying files in DigiDoc file format ASiC-S is not supported.</dd></dl>
<h2><a class="anchor" id="shutting-down"></a>
Shutting down the library</h2>
<p>After finishing work with Libdigidocpp, then the last task is to shut down the library: </p><div class="fragment"><div class="line"><a class="code hl_function" href="namespacedigidoc.html#a121f0363627f62f3972ac4b445986598">digidoc::terminate</a>();</div>
<div class="ttc" id="anamespacedigidoc_html_a121f0363627f62f3972ac4b445986598"><div class="ttname"><a href="namespacedigidoc.html#a121f0363627f62f3972ac4b445986598">digidoc::terminate</a></div><div class="ttdeci">DIGIDOCPP_EXPORT void terminate()</div><div class="ttdef"><b>Definition</b> Container.cpp:157</div></div>
</div><!-- fragment --><p>The termination method closes libraries used in Libdigidocpp implementation and deletes temporary files that may have been written to disk when working with the library.</p>
<h2><a class="anchor" id="exceptions"></a>
Exception handling</h2>
<p>The Libdigidocpp library may throw exceptions that are instances of Exception class (defined in Exception.h source file). The code which uses Libdigidocpp’s API should be wrapped in a try/catch block as follows: </p><div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// code implementation</span></div>
<div class="line"> </div>
<div class="line">} <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code hl_class" href="classdigidoc_1_1Exception.html">digidoc::Exception</a> &amp;e) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;Exception:%s\n&quot;</span>, parseException(e).c_str()); <span class="comment">// Sample exception handling method</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>An Exception instance thrown by the library may contain a stack trace of the hierarchy of exceptions. For example, to parse the whole stack trace, do as follows: </p><div class="fragment"><div class="line">std::string parseException(<span class="keyword">const</span> <a class="code hl_class" href="classdigidoc_1_1Exception.html">digidoc::Exception</a> &amp;e)</div>
<div class="line">{</div>
<div class="line">    std::string result = e.<a class="code hl_function" href="classdigidoc_1_1Exception.html#a15b204bdfbebb71719ad8f40c37c819b">msg</a>() + <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// the error message is retrieved</span></div>
<div class="line">    <span class="comment">// Iteration through the list of causes:</span></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">const</span> <a class="code hl_class" href="classdigidoc_1_1Exception.html">digidoc::Exception</a> &amp;ex: e.causes())</div>
<div class="line">        result += parseException(ex); <span class="comment">// Parsing the exceptions recursively</span></div>
<div class="line">    <span class="keywordflow">return</span> result; <span class="comment">// The error message is returned</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassdigidoc_1_1Exception_html_a15b204bdfbebb71719ad8f40c37c819b"><div class="ttname"><a href="classdigidoc_1_1Exception.html#a15b204bdfbebb71719ad8f40c37c819b">digidoc::Exception::msg</a></div><div class="ttdeci">std::string msg() const</div><div class="ttdef"><b>Definition</b> Exception.cpp:177</div></div>
</div><!-- fragment --><h1><a class="anchor" id="utility"></a>
Libdigidocpp utility program</h1>
<p>The command line utility program digidoc-tool.exe which is included in the Libdigidocpp distribution can be used to test the library or simply use it directly to handle digitally signed documents.</p>
<dl class="section note"><dt>Note</dt><dd>The utility program is intended for testing and presentation of sample implementation of the library’s API. The interface of the utility program is not fixed and its long-term stability is not guaranteed.</dd></dl>
<p>The general format for executing the program is: </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool [command] [options] [input/output file]</div>
<div class="ttc" id="anamespacedigidoc_html"><div class="ttname"><a href="namespacedigidoc.html">digidoc</a></div><div class="ttdef"><b>Definition</b> Conf.h:29</div></div>
</div><!-- fragment --><p>Available optional options on all commands: </p><table class="doxtable">
<tr>
<td>--nocolor </td><td>Disable terminal colors </td></tr>
<tr>
<td>--loglevel=[0,1,2,3,4] </td><td>Log level: 0 - none, 1 - error, 2 - warning, 3 - info, 4 - debug </td></tr>
<tr>
<td>--logfile= </td><td>File to log, empty to console </td></tr>
</table>
<h2><a class="anchor" id="Creating"></a>
Creating and signing a document (local signing)</h2>
<p>Command "create" can be used to create a new DigiDoc container, add data files, optionally some meta-info about the signer and sign the document. Documents can be created only in ASiC-E format. General form of the command is: </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool create --file=&lt;data-file&gt; &lt;output-container-file&gt;</div>
</div><!-- fragment --><p>Available options: </p><table class="doxtable">
<tr>
<td>--file= </td><td>Required</td><td><p class="starttd">Data file(s) to be signed. The option can occur multiple times.</p>
<dl class="section warning"><dt>Warning</dt><dd>It is recommended not to use special characters in the data file’s name, i.e. it is suggested to only use the characters that are categorized as "unreserved" according to RFC3986 (<a href="http://tools.ietf.org/html/rfc3986">http://tools.ietf.org/html/rfc3986</a>). </dd></dl>
</td></tr>
<tr>
<td>--mime= </td><td>Optional</td><td><p class="starttd">Specifies the data file's mime-type value. When used then must be written right after the "--file" parameter. If left unspecified then the default mime-type value "application/octet-stream" is used.</p>
<dl class="section warning"><dt>Warning</dt><dd>Data file’s mime-type value must be formatted as specified in RFC2045, section 5.1 (<a href="https://tools.ietf.org/html/rfc2045#section-5.1">https://tools.ietf.org/html/rfc2045#section-5.1</a>), i.e. the "type" and "subtype" values must be separated with a forward slash character. </dd></dl>
</td></tr>
<tr>
<td>--dontsign </td><td>Optional</td><td>Don't sign the newly created container. </td></tr>
</table>
<p>Additional options for the "create" command are the same as for "sign" command (see <a class="el" href="manual.html#Adding">Adding signatures</a>).</p>
<p>Sample commands for creating and signing DigiDoc files:</p>
<div class="fragment"><div class="line">Sample: creating <span class="keyword">new</span> ASiC-E file, adding multiple data files and signing via PKCS#11 driver</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool create --file=file1.txt --mime=text/plain --file=file2.pdf --mime=application/pdf --country=Estonia</div>
<div class="line">--state=Harjumaa --city=Tallinn --postalCode=12345 --pkcs11 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --file=file1.txt          - a data file to be added to container</div>
<div class="line">  --mime=text/plain         - data file <span class="stringliteral">&#39;file1.txt&#39;</span> mime-type</div>
<div class="line">  --file=file2.pdf          - a data file to be added to container  </div>
<div class="line">  --mime=application/pdf    - data file <span class="stringliteral">&#39;file2.pdf&#39;</span> mime-type</div>
<div class="line">  --country=Estonia         - country where the signature is created</div>
<div class="line">  --state=Harjumaa          - state where the signature is created</div>
<div class="line">  --city=Tallinn            - city where the signature is created</div>
<div class="line">  --postalCode=12345        - postal code of the signature creation location</div>
<div class="line">  --pkcs11                  - signing is done via PKCS#11 <span class="keyword">module</span></div>
<div class="line">  demo-container.asice      - container to be created</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: creating <span class="keyword">new</span> ASiC-E file on Windows, adding data file and signing via CNG API</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool create --file=file1.txt --cng demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --file=file1.txt          - a data file to be added to container</div>
<div class="line">  --cng                     - CNG API is used <span class="keywordflow">for</span> signing</div>
<div class="line">  demo-container.asice      - container to be created</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: creating <span class="keyword">new</span> ASiC-E file on Windows, adding data file and signing via CNG API, dialog windows <span class="keywordflow">for</span> certificate selection and PIN insertion are not displayed</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool create --file=file1.txt --cng --selectFirst --pin=01497 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --file=file1.txt          - a data file to be added to container</div>
<div class="line">  --cng                     - CNG API is used <span class="keywordflow">for</span> signing</div>
<div class="line">  --selectFirst             - the first signing certificate in store is used <span class="keywordflow">for</span> signing</div>
<div class="line">  --pin=01497               - PIN code (PIN2 in <span class="keywordflow">case</span> of Estonian ID cards)</div>
<div class="line">  demo-container.asice      - container to be created</div>
</div><!-- fragment --><h2><a class="anchor" id="createBatch"></a>
Creating and signing multiple documents</h2>
<p>Command "createBatch" Takes folder as argument folder/content/to/sign and sign them separate containers. <br  />
 For additional options look sign command.</p>
<h2><a class="anchor" id="add"></a>
Add additional files to container</h2>
<p>Command "add" for adding additional files to existing unsigned container. <br  />
 Available options are &ndash;file and &ndash;mime look "create" command for info.</p>
<h2><a class="anchor" id="websign"></a>
Creating and signing a document (external signing, e.g. in browser)</h2>
<p>Command "websign" can be used to create a new DigiDoc container, add data files, optionally some meta-info about the signer and sign the document. Documents can be created only in ASiC-E format. External signing use case may be used when signing is done in web applications, the communication with the signer's token and signing the hash is done via a web browser's signing module (plug-in or extension). See also <a href="https://web-eid.eu">https://web-eid.eu</a> for implementing signing in browser environment.</p>
<p>External signing process with websign command is as follows:</p><ol type="1">
<li>After executing the websign command, the utility program outputs the value of hash to be signed (in HEX) to console and waits until user enters the respective signature value</li>
<li>Send the hash to be signed to the signing token (e.g. by using the web signing demo page at <a href="https://open-eid.github.io/hwcrypto.js/sign.html">https://open-eid.github.io/hwcrypto.js/sign.html</a>)</li>
<li>Conduct signing, enter PIN2, retireve the signed hash (signature value) from the signing token</li>
<li>Enter the signature value (also in HEX) to the console</li>
<li>Utility program continues with signing process and outputs the signed container</li>
</ol>
<p>General form of the command is: </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool websign --cert=&lt;signer-certificate&gt; --file=&lt;data-file&gt; &lt;output-container-file&gt;</div>
</div><!-- fragment --><p>Available options: </p><table class="doxtable">
<tr>
<td>--cert= </td><td>Required</td><td>Signer's certificate, in PEM format. </td></tr>
<tr>
<td>--file= </td><td>Required</td><td>Data file(s) to be signed. The option can occur multiple times. </td></tr>
<tr>
<td>--mime= </td><td>Optional</td><td>Specifies the data file's mime-type value. When used then must be written right after the "--file" parameter. If left unspecified then the default mime-type value "application/octet-stream" is used. </td></tr>
</table>
<p>Additional options for the "websign" command are the same as for "sign" command (see <a class="el" href="manual.html#Adding">Adding signatures</a>).</p>
<p>Sample command for creating and external signing of ASiC-E files:</p>
<div class="fragment"><div class="line">Sample: creating <span class="keyword">new</span> ASiC-E file, specifying signers certificate, adding data files and other meta-data and calculating the RSA signature value in browser</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool websign --cert=signer.cer --file=file1.txt --file=file2.pdf --country=Estonia --state=Harjumaa --city=Tallinn --postalCode=12345 --profile=time-stamp demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --cert=signer.cer     - signers certificate</div>
<div class="line">  --file=file1.txt      - a data file to be added to container</div>
<div class="line">  --file=file2.txt      - a data file to be added to container</div>
<div class="line">  --profile=time-stamp  - profile of the signature</div>
<div class="line">  --country=Estonia     - country where the signature is created</div>
<div class="line">  --state=Harjumaa      - state where the signature is created</div>
<div class="line">  --city=Tallinn        - city where the signature is created</div>
<div class="line">  --postalCode=12345    - postal code of the signature creation location</div>
<div class="line">  demo-container.asice  - container to be created</div>
</div><!-- fragment --><h2><a class="anchor" id="Opening"></a>
Opening document, validating signatures and extracting data files</h2>
<p>Command "open" enables to read in an existing DigiDoc document, print out a list of its contents and validate signatures. By specifying the additional option &ndash;extractaAll, then the data files are extracted from the container and stored on the disk. All DigiDoc file formats are supported with this command (except of BDOC1.0). General form of the command is: </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool open &lt;input-container-file&gt;</div>
</div><!-- fragment --><p>Available options: </p><table class="doxtable">
<tr>
<td>--extractAll </td><td>Optional</td><td>If set, then all of the input container’s data files are extracted and written to disk without validating signatures. If an output directory is not specified with the value of this parameter then the extracted files are written to the same directory where the input file is located. </td></tr>
<tr>
<td>&ndash;validateOnExtract </td><td>Optional</td><td>If set, then validates container before extracting files. </td></tr>
<tr>
<td>--policy=(POLv1,POLv2) </td><td>Optional</td><td><p class="starttd">Signature Validation Policy</p>
<p class="intertd">Default POLv2</p>
<p class="endtd"><a href="http://open-eid.github.io/SiVa/siva/appendix/validation_policy/">http://open-eid.github.io/SiVa/siva/appendix/validation_policy/</a> </p>
</td></tr>
<tr>
<td>--offline </td><td>Optional</td><td>open container offline (eg. Don't send to SiVa) </td></tr>
<tr>
<td><p class="starttd">--warnings=</p>
<p class="endtd">(ignore, warning, error) </p>
</td><td>Optional</td><td>Enables to choose the displaying of validation warnings (if present) of the file being opened. Can be used to test the warnings system of the utility program (see also "Validation status VALID WITH WARNINGS"). The options include:<ul>
<li>warning – the default value used. The minor technical errors that are considered as warnings, are printed out as warnings.</li>
<li>error – the errors that are otherwise considered as warnings (by the utility program), are printed out as errors.</li>
<li>ignore – the errors that are otherwise considered as warnings (by the utility program), are not printed out. If there are any other errors present then these are treated as usual. </li>
</ul>
</td></tr>
</table>
<p>Output of the default command contains the following data of the container: </p><div class="fragment"><div class="line">Container file: &lt;container’s file name&gt;</div>
<div class="line">Container type: &lt;container’s mime-type&gt;</div>
<div class="line">Documents (&lt;number of data files in container&gt;):</div>
<div class="line">  Document (&lt;data file’s mime-type&gt;): &lt;file’s name&gt; (&lt;file’s size&gt; bytes)</div>
<div class="line">Signatures (&lt;number of signatures in container&gt;):</div>
<div class="line">  Signature &lt;signature’s sequence number&gt; (&lt;signature’s profile&gt;):</div>
<div class="line">    Validation: &lt;signature validation result: OK/FAILED&gt;</div>
<div class="line">    EPES policy: urn:oid: &lt;signature policy identifier OID&gt;</div>
<div class="line">    SPUri: &lt;URL to the BDOC 2.1 specification document&gt;</div>
<div class="line">    Signature method: &lt;signature method URI&gt;</div>
<div class="line">    Signing time: &lt;signing time according to computer’s settings (not the official signing time)&gt;</div>
<div class="line">    Signing cert: &lt;subject CN field’s value&gt;</div>
<div class="line">    Signed by: &lt;subject CN field’s value&gt;</div>
<div class="line">    Produced At: &lt;time of OCSP response’s issuance, i.e. official signing time&gt;</div>
<div class="line">    OCSP Responder: &lt;OCSP responder certificate CN field’s value&gt;</div>
<div class="line">    Message imprint (&lt;length in bytes&gt;): &lt;OCSP responses nonce field’s or TSA messageImprint value (has to correspond to the &amp;lt;SignatureValue&amp;gt; element’s hash)&gt;</div>
<div class="line">    TS: &lt;TSA certificate CN field’s value&gt;</div>
<div class="line">    TS time: &lt;time of TSA issuance, i.e. official signing time&gt;</div>
<div class="line">    TSA: &lt;archive TSA certificate CN field’s value&gt;</div>
<div class="line">    TSA time: &lt;time of archive TSA issuance, i.e. official signing time&gt;</div>
<div class="line">    Warnings: &lt;possible validation related warnings (see explanation below)&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>By default, if the signature validation process discovered errors that are regarded as minor technical errors in digidoc-tool.cpp utility program then the document is considered as VALID WITH WARNINGS, the errors are printed out as warnings to the end user. See also chapter <a class="el" href="manual.html#validation-status">Determining the validation status</a>.</dd></dl>
<p>Sample commands for validating signatures and extracting data files: </p><div class="fragment"><div class="line">Sample: opening ASiC-E container, listing its contents and validating signatures</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool open demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  demo-container.asice  - input DigiDoc file which contents are listed and signatures validated</div>
<div class="line"> </div>
<div class="line">Output:</div>
<div class="line">  Container type: application/vnd.etsi.asic-e+zip</div>
<div class="line">  Documents (2):</div>
<div class="line">    Document (application/octet-stream): file1.txt (434 bytes)</div>
<div class="line">    Document (application/octet-stream): file2.pdf (476841 bytes)</div>
<div class="line">  Signatures (1):</div>
<div class="line">    Signature 0 (EPES/time-mark):</div>
<div class="line">      Validation: OK</div>
<div class="line">      EPES policy: urn:oid:1.3.6.1.4.1.10015.1000.3.2.1</div>
<div class="line">      SPUri: https:<span class="comment">//www.skidsolutions.eu/repository/bdoc-spec21.pdf</span></div>
<div class="line">      Signature method: http:<span class="comment">//www.w3.org/2001/04/xmldsig-more#rsa-sha256</span></div>
<div class="line">      Signing time: 2013-03-13T08:48:13Z</div>
<div class="line">      Signing cert: MÄNNIK,MARI-LIIS,47101010033</div>
<div class="line">      Signed by: MÄNNIK,MARI-LIIS,47101010033</div>
<div class="line">      Produced At: 2013-05-14T23:41:20Z</div>
<div class="line">      OCSP Responder: TEST of SK OCSP RESPONDER 2011</div>
<div class="line">      Message imprint (51): 30 31 30 0D 06 09 60 86 48 01 65 03 04 02 01 05 00 04 20 10 35 D7 45 F1 42 C1 0C 4D 96 EA 1A 13 C4 34 28 B0 8A 0A 07 47 AA 96 72 0D 3B 1C C9 02 D0 4B 15</div>
<div class="line">      TS:</div>
<div class="line">      TS time:</div>
<div class="line">      TSA:</div>
<div class="line">      TSA time:</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: opening ASiC-E container, listing its contents and validating signatures (warnings are displayed as SHA-1 hash function is used in a ASiC-E file)</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool open weak-sha.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  weak-sha.asice            - input file which contents are listed and signatures validated</div>
<div class="line"> </div>
<div class="line">Output:</div>
<div class="line">  Container type: application/vnd.etsi.asic-e+zip</div>
<div class="line">  Documents (1):</div>
<div class="line">    Document (application/octet-stream): test.txt (314 bytes)</div>
<div class="line">  Signatures (1):</div>
<div class="line">    Signature 0 (EPES/time-mark):</div>
<div class="line">      Validation: OK</div>
<div class="line">      EPES policy: urn:oid:1.3.6.1.4.1.10015.1000.3.2.1</div>
<div class="line">      SPUri: https:<span class="comment">//www.skidsolutions.eu/repository/bdoc-spec21.pdf</span></div>
<div class="line">      Signature method: http:<span class="comment">//www.w3.org/2000/09/xmldsig#rsa-sha1</span></div>
<div class="line">      Signing time: 2012-11-13T11:04:32Z</div>
<div class="line">      Signing cert: MÄNNIK,MARI-LIIS,47101010033</div>
<div class="line">      Signed by: MÄNNIK,MARI-LIIS,47101010033</div>
<div class="line">      Produced At: 2012-11-13T11:04:45Z</div>
<div class="line">      OCSP Responder: TEST of SK OCSP RESPONDER 2011</div>
<div class="line">      Message imprint (51): 30 31 30 0D 06 09 60 86 48 01 65 03 04 02 01 05 00 04 20 10 35 D7 45 F1 42 C1 0C 4D 96 EA 1A 13 C4 34 28 B0 8A 0A 07 47 AA 96 72 0D 3B 1C C9 02 D0 4B 15</div>
<div class="line">      TS:</div>
<div class="line">      TS time:</div>
<div class="line">      TSA:</div>
<div class="line">      TSA time:</div>
<div class="line">      Warnings: RefereneceDigestWeak, SignatureDigestWeak,</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: opening container, extracting its data files</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool open --extractAll demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --extractAll=demo     - Extract all files into current folder</div>
<div class="line">  demo-container.asice  - input DigiDoc file that is extracted</div>
<div class="line"> </div>
<div class="line">Output:</div>
<div class="line">  Extracting documents:</div>
<div class="line">    Document(application/octet-stream) extracted to file1.txt (434 bytes)</div>
<div class="line">    Document(application/octet-stream) extracted to file2.pdf (476841 bytes)</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: opening container, extracting its data files to a specific directory</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool open --extractAll=demo demo-container.bdoc</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --extractAll=demo     - Extract all files into folder <span class="stringliteral">&quot;demo&quot;</span></div>
<div class="line">  demo-container.bdoc   - input DigiDoc file that is extracted</div>
<div class="line"> </div>
<div class="line">Output:</div>
<div class="line">  Extracting documents:</div>
<div class="line">    Document(application/octet-stream) extracted to demo/file1.txt (434 bytes)</div>
<div class="line">    Document(application/octet-stream) extracted to demo/file2.pdf (476841 bytes)</div>
</div><!-- fragment --><h2><a class="anchor" id="Adding"></a>
Adding signatures</h2>
<p>Command "sign" enables adding signatures to existing DigiDoc containers. The command is supported with DigiDoc formats BDOC 2.1 and ASiC-E. </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool sign &lt;modified-<a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-container&gt;</div>
</div><!-- fragment --><table class="doxtable">
<tr>
<td>--pin= </td><td>Optional</td><td>If PIN is not provided with this parameter value and (the default) PKCS#11 module is used for signing then the utility program asks for the user to insert PIN code to command line during the program’s execution time. </td></tr>
<tr>
<td>--profile= </td><td>Optional</td><td>Profile of the signature. Possible values are:<ul>
<li>TS - a time-stamp and OCSP confirmation will be added to the signature as validation data.</li>
<li>TSA - a time-stamp and OCSP confirmation will be added to the signature as validation data. Additional time-stamp is added for notarize all certificate and revocation info. </li>
</ul>
</td></tr>
<tr>
<td>--XAdESEN </td><td>Optional</td><td>Use XAdES EN profile. </td></tr>
<tr>
<td>--city= </td><td>Optional</td><td>City where the signature is created. </td></tr>
<tr>
<td>--street= </td><td>Optional</td><td>streetAddress of production place in XAdES EN profile. </td></tr>
<tr>
<td>--state= </td><td>Optional</td><td>State or province where the signature is created. </td></tr>
<tr>
<td>--postalCode= </td><td>Optional</td><td>Postal code of the place where the signature is created. </td></tr>
<tr>
<td>--country= </td><td>Optional</td><td>Country of origin. ISO 3166-type 2-character country codes are used (e.g. EE) </td></tr>
<tr>
<td>--role= </td><td>Optional</td><td>Signer’s role(s). The option can occur multiple times. </td></tr>
<tr>
<td>--sha(224,256,384,512) </td><td>Optional</td><td>Used for testing purposes. Specifies the hash function that is used when calculating digest values. If not specified then SHA-256 is used by default. </td></tr>
<tr>
<td>--sigsha(224,256,384,512) </td><td>Optional</td><td>Used for testing purposes. Specifies the hash function that is used for calculating the hash that is being signed. If not specified then SHA-256 is used by default. </td></tr>
<tr>
<td>--sigpsssha(224,256,384,512) </td><td>Optional</td><td>Used for testing purposes. With RSA keys RSA-PSS padding is used. Specifies the hash function that is used for calculating the hash that is being signed. If not specified then SHA-256 is used by default. Same as --sigsha* with --rsapss </td></tr>
<tr>
<td>--rsapkcs15 </td><td>Optional</td><td>Option to change RSA Signature padding (RSA PKCS1.5). </td></tr>
<tr>
<td>--rsapss </td><td>Optional</td><td>Option to change RSA Signature padding (RSA PSS). </td></tr>
<tr>
<td>--tsurl </td><td>Optional</td><td>Option to change TS URL. </td></tr>
<tr>
<td>--dontValidate </td><td>Optional</td><td>Don't validate container on signature creation. </td></tr>
</table>
<p>Options for specifying module used for accessing the signing token - possible alternatives are PKCS#11, CryptoAPI/CNG and PKCS#12 (for testing purposes). When signing module is not specified then PKCS#11 module is used by default. </p><table class="doxtable">
<tr>
<td>--pkcs11[=] </td><td>Optional</td><td>Signing is done via PKCS#11 module - the default module for singing with smart card in Linux and macOS. When signing via PKCS#11 module then the parameter’s value can be used to specify the path and filename of PKCS#11 driver in your file system. For example, "opensc-pkcs11.dll" in Windows environment and "opensc-pkcs11.so" in Linux and OSX. If the parameter’s value is left unspecified then PKCS#11 driver’s location is looked up from configuration file (see also chap. <a class="el" href="manual.html#parameters">Configuration parameters</a>). </td></tr>
<tr>
<td>--cng </td><td>Optional</td><td>Set the parameter to sign via Microsoft CNG API (in Windows environment). If "--pin" parameter’s value is not set then PIN insertion dialog is displayed to the user. Parameter "--cng" may optionally be used along with parameter "--selectFirst" or "--thumbprint". </td></tr>
<tr>
<td>--selectFirst </td><td>Optional</td><td>Additional parameter that can optionally be used along with parameter "–cng". When the parameter is set then the first certificate in Windows certificate store is chosen for signature creation. If the parameter is not set then certificate selection dialog window is displayed to user. </td></tr>
<tr>
<td>--thumbprint </td><td>Optional</td><td>Additional parameter that can optionally be used along with parameter "–cng". When the parameter is set then the certificate by thumbprint in Windows certificate store is chosen for signature creation. If the parameter is not set then certificate selection dialog window is displayed to user. </td></tr>
<tr>
<td>--pkcs12= </td><td>Optional</td><td>Signing is done via PKCS#12 module - can be used for testing purposes. Enables to use a PKCS#12 software token (containing the signing certificate and private key) for signature creation. Note that the created signature is not a valid signature and it is not equal to handwritten signature as the PKCS#12 software token is not considered a secure signature creation device. </td></tr>
</table>
<p>Sample commands for adding signatures: </p><div class="fragment"><div class="line">Sample: adding a signature via PKCS#11 driver</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool sign --pkcs11 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --pkcs11              - PKCS#11 <span class="keyword">module</span> is used for signing</div>
<div class="line">  demo-container.asice  - container to be modified</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: adding a signature via CNG API</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool sign --cng demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --cng                 - CNG API is used <span class="keywordflow">for</span> signing</div>
<div class="line">  demo-container.asice  - container to be modified</div>
</div><!-- fragment --><div class="fragment"><div class="line">Sample: adding a signature via CNG API, no dialog windows are displayed</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool sign --cng --selectFirst --pin=12345 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --cng                 - CNG API is used <span class="keywordflow">for</span> signing</div>
<div class="line">  --selectFirst         - the first signing certificate is used <span class="keywordflow">for</span> signing</div>
<div class="line">  --pin=12345           - PIN code (PIN2 in <span class="keywordflow">case</span> of Estonian ID cards)</div>
<div class="line">  demo-container.asice  - container to be modified</div>
</div><!-- fragment --><h2><a class="anchor" id="Removing"></a>
Removing signatures and data files</h2>
<p>Signatures and data files can be removed from a DigiDoc container with the command "remove". Note that it is possible to remove data files only from an unsigned container (i.e all signatures must be removed before removing data files). The command is supported with DigiDoc formats BDOC 2.1 and ASiC-E. General format of the command is: </p><div class="fragment"><div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool remove --document=&lt;doc-<span class="keywordtype">id</span>&gt; --signature=&lt;sig-<span class="keywordtype">id</span>&gt; &lt;modified-<a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-container&gt;</div>
</div><!-- fragment --><p>Available options: </p><table class="doxtable">
<tr>
<td>--document= </td><td>Optional</td><td>Specifies the sequence number of the data file that is removed from the container. The sequence numbers are counted from zero. </td></tr>
<tr>
<td>--signature= </td><td>Optional</td><td>Specifies the sequence number of the signature that is removed from the container. The sequence numbers are counted from zero. </td></tr>
</table>
<p>Sample commands for removing signatures and data files: </p><div class="fragment"><div class="line">Sample: removing signature from container</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool remove --signature=1 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --signature=1         - sequence number of the signature that is removed</div>
<div class="line">  demo-container.asice  - container to be modified</div>
</div><!-- fragment --> <div class="fragment"><div class="line">Sample: removing data files from container</div>
<div class="line">&gt; <a class="code hl_namespace" href="namespacedigidoc.html">digidoc</a>-tool remove --document=0 --document=1 demo-container.asice</div>
<div class="line"> </div>
<div class="line">Input:</div>
<div class="line">  --document=0          - sequence number of the data file that is removed</div>
<div class="line">  --document=1          - sequence number of the data file that is removed</div>
<div class="line">  demo-container.asice  - container to be modified</div>
</div><!-- fragment --><h1><a class="anchor" id="supported-tokens"></a>
National and cross-border support</h1>
<h2><a class="anchor" id="TSL-overview"></a>
TSL list usage in Libdigidocpp</h2>
<p>Libdigidocpp library uses Trust Service status Lists (TSL) as trust anchors. TSL lists are a standardized way to add support for cross-border trust-service providers, e.g. CA's that issue qualified certificates, OCSP service and time-stamping service providers (see also <a class="el" href="manual.html#TSL">TSL specification</a>). TSL list is a digitally signed a document in XML format, the list is accompanied with a TSL signing certificate that is used to validate the list's signature.</p>
<p>Libdigidocpp library uses the <b>European Commission’s TSL list </b> as the basis of retrieving data of trusted certificates. The European Commission's TSL list is also referred to as List of Trusted Lists (LOTL), meaning that it is central list that contains references to other TSL lists, in this case the national TSL lists of the European Union's member states. </p><dl class="section note"><dt>Note</dt><dd>The European Commission's TSL that contains URL's and certificates of the national TSL lists can be downloaded here: <a href="https://ec.europa.eu/tools/lotl/eu-lotl.xml">https://ec.europa.eu/tools/lotl/eu-lotl.xml</a></dd></dl>
<p>Each of the national TSL list contains data (including the certificates) of the trust service providers that are approved in this particular country. Libdigidocpp supports <b>all national TSL lists that are referred to in the LOTL (more than 30 countries). </b></p>
<dl class="section note"><dt>Note</dt><dd>For information about using test TSL lists with Libdigidocpp library, please refer to <a href="https://github.com/open-eid/libdigidocpp/wiki/Using-test-TSL-lists">https://github.com/open-eid/libdigidocpp/wiki/Using-test-TSL-lists</a></dd></dl>
<h3><a class="anchor" id="TSL-init"></a>
TSL initialization process</h3>
<p>TSL lists' initialization process is done during each initialization of the library. By default, the TSL itself and its freshness is checked on-line:</p><ol type="1">
<li>It is checked if LOTL (the master TSL list, tl-mp.xml) is present at the tsl.cache location</li>
<li>If there is no such list present in the cache directory and the online updating mechanism is enabled (see <a class="el" href="manual.html#CA-settings">Trust anchor/TSL settings</a>, "tsl.autoupdate") then the TSL list is downloaded from the list's URL (<a href="https://ec.europa.eu/tools/lotl/eu-lotl.xml">https://ec.europa.eu/tools/lotl/eu-lotl.xml</a>) and saved to tsl.cache directory <dl class="section note"><dt>Note</dt><dd>tsl.autoupdate can be disabled but then the TSL list(s) must be manually saved to the tsl.cache location.</dd>
<dd>
the TSL lists are not distributed along with the library's installation package, meaning that during the first initialization of the library, the TSL lists need to be downloaded on-line or must be manually copied to the tsl.cache location.</dd></dl>
</li>
<li>If there is an existing LOTL in the tsl.cache location and the tsl.onlineDigest check is enabled (see <a class="el" href="manual.html#CA-settings">Trust anchor/TSL settings</a>, "tsl.onlineDigest") then the freshness of the TSL list is checked based on the list's SHA-256 hash value:<ul>
<li>The existing TSL list’s hash is calculated over the binary representation of the list</li>
<li>The officially published hash value is downloaded (from the same address as the TSL's URL but with .sha2 extension)</li>
<li>The hash of existing TSL and the value downloaded on-line are compared<ul>
<li>If values are different then a new version of the TSL list is downloaded</li>
<li>If the hash values are the same or it was not possible to download the hash value from external URL then new version of the TSL is not downloaded. TSL parsing/validation process is continued.</li>
</ul>
</li>
</ul>
</li>
<li>The LOTL is validated:<ul>
<li>the list's validity is checked in by comparing the user's computer time with the list's &lt;NextUpdate&gt; value.<ul>
<li>if the list is not valid then the library attempts to download a new list from the list's URL</li>
</ul>
</li>
<li>the list's signature is validated by using its signing certificate</li>
</ul>
</li>
<li>National TSLs' data (URLs and certificates) are read from the LOTL.</li>
<li>For each of the national TSL list, the following is done:<ul>
<li>step 1-3 of the current process is repeated with the national TSL list</li>
<li>appropriate trust services are found from the national TSL lists, their certificates are added to the library's internal trusted certificates' store.</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="tokens"></a>
Identity tokens in Libdigidocpp</h2>
<p>Libdigidocpp library supports the following identity tokens:</p><ul>
<li>Estonian national eID card and Digi-ID</li>
</ul>
<p>The library is also tested with the following tokens (indirectly via the DigiDoc desktop application that uses Libdigidocpp as a base component):</p><ul>
<li>Finnish national eID card</li>
<li>Latvian national eID card</li>
<li>Lithuanian national eID card</li>
<li>SafeNet eToken 5110 with SK issued certificates for organizations</li>
</ul>
<h1><a class="anchor" id="testing"></a>
Interoperability testing</h1>
<h2><a class="anchor" id="cross-usability"></a>
DigiDoc framework cross-usability tests</h2>
<p>Automated cross-usability tests of digitally signed and encrypted files are periodically carried out between different <a class="el" href="manual.html#DD-libs">DigiDoc software libraries</a>:</p><ul>
<li>Cross-usability of ASiC-E file format with TS (time-stamp) profile is tested between DigiDoc4j and Libdigidocpp libraries.</li>
</ul>
<p>The interoperability tests are executed through the command line utility tools of the software libraries (for example, in case of Libdigidocpp library, the utility program which is described in chapter <a class="el" href="manual.html#utility">Libdigidocpp utility program</a> of the current document).</p>
<h1><a class="anchor" id="implementation-notes"></a>
Libdigidocpp implementation notes</h1>
<p>The following section describes properties of a BDOC 2.1 file that are not strictly defined in the BDOC 2.1 specification <a class="el" href="manual.html#BDOC">BDOC2.1:2013</a> but are used in Libdigidocpp library’s implementation (and also in other DigiDoc software libraries) of the file format.</p>
<h2><a class="anchor" id="signature-notes"></a>
Digital signature related notes</h2>
<ol type="1">
<li>The supported BDOC 2.1 signature profiles are BDOC-TM (XAdES-EPES signature with time-mark) and BDOC-TS (XAdES-BES signature with time-stamp and OCSP confirmation). The basic BDOC-TM profile is XAdES-EPES as BDOC 2.1 specification requires that &lt;SignaturePolicyIdentifier&gt; element is present (<a class="el" href="manual.html#BDOC">BDOC2.1:2013</a>, chap. 5.2). The basic BDOC-TS profile is XAdES-BES as the &lt;SignaturePolicyIdentifier&gt; element is not supported in case of BDOC 2.1 signatures with time-stamps. It is expected that either a time-mark or time-stamp and OCSP confirmation have been added to the signature as according to BDOC 2.1 specification (<a class="el" href="manual.html#BDOC">BDOC2.1:2013</a>, chap. 6) a signature is not considered complete or valid without validation data from external services (i.e. a time-mark or time-stamp).</li>
<li>For better international compatibility reasons, the library also accepts BDOC-TS signatures that are based on XAdES-EPES basic profile during validation time (i.e. the signature contains &lt;SignaturePolicyIdentifier&gt; element and a time-stamp).</li>
<li>One time-mark is allowed for each signature in case of TM profile; one time-stamp and one OCSP confirmation are allowed for each signature in case of TS profile (due to security reasons and in order to maintain testing efficiency).</li>
<li>In case of BDOC signature with time-mark, the OCSP confirmation's (i.e. time-mark's) nonce field’s value is calculated as follows:<ul>
<li>the contents of &lt;SignatureValue&gt; element (i.e. the value without XML tags) is taken and decoded from base64 encoding;</li>
<li>digest of the value found in the previous step is calculated by using SHA-256 algorithm.;</li>
<li>the digest value found in the previous step and the digest algorithm that was used are transformed as defined by the following ASN.1 structure: <div class="fragment"><div class="line">TBSDocumentDigest ::= SEQUENCE {</div>
<div class="line">    algorithm AlgorithmIdentifier,</div>
<div class="line">    digest OCTET STRING</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>the ASN.1 block value produced in the previous step is included in the OCSP request’s "nonce" field and must be present in the respective field of the OCSP response.</li>
</ul>
</li>
<li>In case of signing with ECC keys (by using ECDSA algorithm), concatenation method is used for creating signature value.</li>
<li>SHA-256 hash function is used by default when calculating data file digests and the digest that is signed.</li>
<li>When a hash function that is weaker than SHA-256 (or SHA-224 in the special case with pre-2011 ID-cards) has been used then a warning message about weak digest method is produced to the user. It is recommended to regard the error as a validation warning (identically to DigiDoc desktop application and digidoc-tool.cpp utility program).</li>
<li>During signature creation, it is checked that there is only one &lt;ClaimedRole&gt; element in the signature, which contains the signer’s role and optionally the signer’s resolution. If the &lt;ClaimedRole&gt; element contains both role and resolution then they must be separated with a slash mark, e.g. "role / resolution". Note that when setting the resolution value then role must also be specified.</li>
<li>XML namespace prefixes are used in case of all XML elements (e.g. "asic:", "ds:", "xades:").</li>
<li>The data file’s MIME type that is used in case of Libdigidocpp’s utility program is always "application/octet-stream" for testing purposes.</li>
<li>The &lt;ds:Signature&gt; element’s Id attribute value is set to "S&lt;seq_no&gt;" during signature creation where sequence numbers are counted from zero. Other Id values that are used in the sub-elements of the &lt;ds:Signature&gt; element contain the signature’s Id value as a prefix. During verification, different Id attribute values are also supported but are not tested periodically.</li>
<li>signatures*.xml file's XML structure validation is done on the basis of XAdES XML Schema (<a class="el" href="manual.html#XAdES">XAdES</a>), however, there are additional checks to determine any unsupported elements that are allowed by the XAdES specification. The unsupported elements are CounterSignature, AttributeCertificateRefs, AttributeRevocationRefs, RefsOnlyTimeStamp, AttrAuthoritiesCertValues, AttributeRevocationValues, CommitmentTypeIndicationType, AllDataObjectsTimeStamp, IndividualDataObjectsTimeStampType.</li>
<li>Special characters in URI attribute values are handled according to RFC3986 (since v3.9 of the library): the characters are percent-encoded, except of unreserved characters and delimiters. Both percent-encoded and non-percent-encoded characters are supported during signature's validation.</li>
<li>When validating a BDOC-TS document then the difference between OCSP validity confirmation's production time (producedAt field) and time-stamp's production time (getTime field) is checked. An exception is thrown if the OCSP confirmation's time is earlier than time-stamp's time. If the OCSP confirmation's time is later than time-stamp's time by more than 15 minutes then a warning is returned. If the difference is more than 24 hours then exception is thrown.</li>
<li>During signature creation, it is checked that the difference between the signer's computer time and the OCSP response's production time (producedAt value) would not exceed 15 minutes. If the difference exceeds 15 minutes then an exception is returned and signing is cancelled.</li>
</ol>
<h2><a class="anchor" id="cert-notes"></a>
Certificate related notes</h2>
<ol type="1">
<li>Valid signatures (qualified electronic signatures) can be created with a certificate that has "Non-repudiation" value (also referred to as "Content Commitment") in its "Key usage" field. The requirement is based on the following sources:<ul>
<li><a class="el" href="manual.html#nat-cert">ETSI TS 102 280 (V1.1.1)</a>: "X.509 V3 Certificate Profile for Certificates Issued to Natural Persons"; chap. 5.4.3;</li>
</ul>
</li>
<li>Signature can be created with a certificate that doesn’t have "Non-repudiation" value in its "Key-Usage" field when specific parameters have been set but validation of such signature will produce a respective error message and the signature is not considered as a qualified electronic signature.</li>
<li>During signature validation, it is checked that the validity periods of the signer’s certificate and all the certificates in its CA chain include the signature creation time (value of the time in TSA response or case time-mark profile producedAt field in OCSP response).</li>
</ol>
<h2><a class="anchor" id="container-notes"></a>
Container related notes</h2>
<ol type="1">
<li>ASiC-E files are created with .asice or .sce file extension.</li>
<li>Signatures are stored in META-INF/signatures*.xml files where ‘*’ is a sequence number, counting is started from zero.</li>
<li>It is not allowed to add two data files with the same name to the container as the signed data file must be uniquely identifiable in the container.</li>
<li>All data files in the container must be signed. All signatures in the container must sign all of the data files.</li>
<li>Relative file paths are used, for example "META-INF/signatures*.xml" and "document.txt" instead of "/META-INF/signatures*.xml" and "/document.txt" to ensure better interoperability with third party applications when validating signatures.</li>
<li>The ZIP container’s comment field contains application name of the library that was used for creating the file. The value can be useful, for example, when trying to determine the origin of an erroneous file.</li>
<li>"mimetype" file is not compressed in the ASiC-E file’s ZIP container as the results of ASiC plug-tests event shows that this solution is most widely used.</li>
<li>When a data file is added to the container then the modification time of the file (as it is registered in the file system) is preserved also in the ZIP container file. There is an exception if the file is added by reading it from an input stream - in that case, the current timestamp value is registered as "last modified" time in the ZIP file. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Sep 24 2025 05:40:12 for libdigidocpp by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
